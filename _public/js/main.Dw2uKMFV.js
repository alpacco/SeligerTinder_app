var De=(c,g)=>()=>(g||c((g={exports:{}}).exports,g),g.exports);import{i as ve,_ as Oe}from"./card.BorwUCbp.js";import{r as Re,i as He}from"./pro.LCHVUHva.js";import{s as Fe,i as We}from"./pro-modal.Deig-JMx.js";import"./utils.DE1O8Krf.js";import"./api.u-GyJUGh.js";import"./gift.IGWJdFdP.js";var Ge=De((tt,G)=>{window.initProfileEditScreen=ve;window.renderProInfo=Re;window.initProFeatures=He;window.showProModal=Fe;window.initProModalHandlers=We;let l=null;window.Telegram&&window.Telegram.WebApp?(l=window.Telegram.WebApp,l.expand(),l.setHeaderColor("#ffffff"),l.setBackgroundColor("#f4f4f4"),console.log("‚úÖ Telegram.WebApp –ø–æ–¥–∫–ª—é—á–µ–Ω:",l),console.log("‚ÑπÔ∏è tg.initData:",l.initData),console.log("‚ÑπÔ∏è tg.initDataUnsafe:",l.initDataUnsafe)):console.warn("‚ö† Telegram.WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π/–ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º?)");const p=typeof window<"u"&&window.API_URL?window.API_URL:typeof window<"u"&&window.API_BASE_URL?window.API_BASE_URL:"https://sta-black-dim.waw.amverum.cloud/api",F=window.location.hostname==="localhost",V=typeof window<"u"&&window.WEB_APP_URL?window.WEB_APP_URL:"https://sta-black-dim.waw.amverum.cloud";let W=null,t={userId:"UserID",name:"Username",username:"",photoUrl:"/img/logo.svg",gender:"",bio:"",age:0,photos:[],registered:!1,likes:[],dislikes:[],badge:"",needPhoto:0,hideAge:!1,API_URL:p};console.log("‚ÑπÔ∏è –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π currentUser:",t);console.log("üîç tg –æ–±—ä–µ–∫—Ç:",l);console.log("üîç tg.initDataUnsafe:",l==null?void 0:l.initDataUnsafe);var Se;console.log("üîç tg.initDataUnsafe.user:",(Se=l==null?void 0:l.initDataUnsafe)==null?void 0:Se.user);var ke;if(l&&l.initDataUnsafe&&l.initDataUnsafe.user){const c=l.initDataUnsafe.user;console.log("‚ÑπÔ∏è tg.initDataUnsafe.user =",c),console.log("üîç u.id:",c.id,"—Ç–∏–ø:",typeof c.id),console.log("üîç u.first_name:",c.first_name,"—Ç–∏–ø:",typeof c.first_name),console.log("üîç u.username:",c.username,"—Ç–∏–ø:",typeof c.username),console.log("üîç u.photo_url:",c.photo_url,"—Ç–∏–ø:",typeof c.photo_url),t.userId=String(c.id||"UserID"),t.name=c.first_name||"Username",t.username=c.username||"",c.photo_url&&c.photo_url.startsWith("http")&&(t.photoUrl=c.photo_url),console.log("‚úÖ currentUser –æ–±–Ω–æ–≤–ª—ë–Ω –∏–∑ tg.initDataUnsafe:",t)}else console.warn("‚ö† –ù–µ –ø–æ–ª—É—á–∏–ª–∏ initDataUnsafe.user ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É"),console.log("üîç tg:",!!l),console.log("üîç tg.initDataUnsafe:",!!(l!=null&&l.initDataUnsafe)),console.log("üîç tg.initDataUnsafe.user:",!!((ke=l==null?void 0:l.initDataUnsafe)!=null&&ke.user));console.log("üîµ [MAIN.JS] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º window.currentUser –∏ window.API_URL –°–†–ê–ó–£...");window.currentUser=t;window.API_URL=p;window.API_BASE_URL=p;window.WEB_APP_URL=V;console.log("  ‚úÖ window.currentUser —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",window.currentUser);console.log("  ‚úÖ window.API_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",window.API_URL);function T(){if(document.readyState==="loading"){setTimeout(T,100);return}const c=document.querySelector("#screen-welcome .user-name");c&&t&&t.name&&t.name!=="Username"&&(c.textContent=t.name,console.log("  ‚úÖ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ:",t.name))}T();function z(c,g,h){if(c.innerHTML="",g<2){c.style.display="none";return}c.style.display="flex";for(let r=0;r<g;r++){const u=document.createElement("div");u.className=r===h?"pag_active":"pag",c.appendChild(u)}}console.log("üîµ [MAIN.JS] –°–∫—Ä–∏–ø—Ç main.js –∑–∞–≥—Ä—É–∂–µ–Ω (–¥–æ DOMContentLoaded)");console.log("  - document.readyState:",document.readyState);console.log("  - window.API_URL:",window.API_URL);console.log("  - window.API_BASE_URL:",window.API_BASE_URL);document.addEventListener("DOMContentLoaded",()=>{console.log("‚ñ∂ [MAIN.JS] DOMContentLoaded: init main.js..."),console.log("  - document.readyState:",document.readyState),console.log("  - API_URL:",p),console.log("  - currentUser:",t),console.log("  - typeof showScreen:",typeof f),W=f,console.log("  - showScreenImpl —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",typeof W);let c=null;const g=document.getElementById("gift-modal");g&&g.classList.remove("open");const h=document.querySelector(".gift-backdrop");h&&h.classList.remove("open");const r=document.getElementById("singleCard");let u=[],I=0,S=0,N=!1,_=null;function Ee(e){console.log(`üîµ [MAIN.JS] showScreenFallback –≤—ã–∑–≤–∞–Ω–∞ —Å screenId: ${e}`),document.querySelectorAll(".screen").forEach(s=>{s.classList.remove("active"),s.style.display="none"});const n=document.getElementById(e);n?(n.classList.add("active"),n.style.display="flex",console.log(`  ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω ${e} (fallback)`)):console.error(`  ‚ùå –≠–∫—Ä–∞–Ω ${e} –Ω–µ –Ω–∞–π–¥–µ–Ω!`)}console.log("üîµ [MAIN.JS] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π window.showScreen (fallback)..."),window.showScreen=Ee,console.log("  ‚úÖ window.showScreen —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤—Ä–µ–º–µ–Ω–Ω—ã–π):",typeof window.showScreen),console.log("üîµ [MAIN.JS] –û–±–Ω–æ–≤–ª—è–µ–º window.currentUser –∏ window.API_URL..."),window.currentUser=t,window.API_URL=p,window.API_BASE_URL=p,window.WEB_APP_URL=V,console.log("  ‚úÖ window.currentUser –æ–±–Ω–æ–≤–ª—ë–Ω:",window.currentUser),console.log("  ‚úÖ window.API_URL –æ–±–Ω–æ–≤–ª—ë–Ω:",window.API_URL),setTimeout(()=>{const e=document.getElementById("screen-welcome");if(e&&e.classList.contains("active")){console.log("üîµ [MAIN.JS] –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∞–∫—Ç–∏–≤–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º –∏–º—è...");const o=document.querySelector("#screen-welcome .user-name");o&&t&&t.name?(o.textContent=t.name,console.log("  ‚úÖ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ (–≤—Ä—É—á–Ω—É—é):",t.name)):console.warn("  ‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∏–º—è:",{welcomeUserName:!!o,currentUser:!!t,userName:t==null?void 0:t.name})}},100),Oe(()=>import("./user-actions.DbKfUyWR.js"),[]).then(e=>{window.handlePhotoAddition=e.handlePhotoAddition,console.log("‚úÖ handlePhotoAddition –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å")}).catch(e=>{console.warn("‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å handlePhotoAddition:",e)});function Pe(e,o){let n=(o.photos||[]).filter(s=>s&&s.trim()!=="");n.length===0&&(n=["/img/photo.svg"]),e.style.backgroundImage=`url('${n[0]}')`,e.dataset.photos=JSON.stringify(n),S=0,e.dataset.userId=o.id,e.innerHTML=`
    <div class="gradient-card"></div>
    <div class="user-info">
      ${o.badge?`<div class="badge-wrapper"><img src="https://sta-black-dim.waw.amverum.cloud${o.badge}" class="badge-image"></div>`:""}
      <div class="name-age-container">
        <span class="user-name">${o.name}</span>
        ${!t.hideAge&&o.age?`<span class="user-age">${o.age} –ª–µ—Ç</span>`:""}
      </div>
      <p class="user-bio">${o.bio||""}</p>
      <div class="paginator"></div>
    </div>
    <div class="card-badge badge-like">üòç</div>
    <div class="card-badge badge-nope">üö´</div>
    <div class="card-badge badge-match"></div>
  `,z(e.querySelector(".paginator"),n.length,0)}function A(){console.log("üîµ [MAIN.JS] setupJoinButton –≤—ã–∑–≤–∞–Ω–∞"),console.log("  - document.readyState:",document.readyState),console.log("  - API_URL:",p),console.log("  - typeof showScreen:",typeof f),console.log("  - currentUser:",t),console.log("  - window.showScreen:",typeof window.showScreen),console.log("  - window.currentUser:",window.currentUser);const e=document.getElementById("join-button");if(e){if(console.log("‚úÖ [MAIN.JS] –ö–Ω–æ–ø–∫–∞ join-button –Ω–∞–π–¥–µ–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫"),console.log("  - joinButton:",e),console.log("  - joinButton.onclick:",e.onclick),e.getAttribute("data-main-handler")==="true"){console.log("  ‚ö†Ô∏è [MAIN.JS] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º");return}e.setAttribute("data-main-handler","true"),console.log("  üîµ [MAIN.JS] –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ click..."),e.addEventListener("click",()=>{console.log("üîµ [MAIN.JS] –ö–ª–∏–∫ –ø–æ join-button - –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏");let n={};l&&l.initDataUnsafe&&l.initDataUnsafe.user?(n=l.initDataUnsafe.user,console.log("  - tgUser –∏–∑ initDataUnsafe:",n)):console.warn("  ‚ö†Ô∏è tg.initDataUnsafe.user –Ω–µ –Ω–∞–π–¥–µ–Ω");const s={userId:String(n.id||"UserID"),name:n.first_name||"Username",username:n.username||"",photoUrl:n.photo_url&&n.photo_url.startsWith("http")?n.photo_url:"/img/logo.svg",gender:"",bio:""};console.log("üîµ [MAIN.JS] –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏:",s),console.log("  - URL:",`${p}/join`);const i={"Content-Type":"application/json"};l&&l.initData&&(i["X-Telegram-Init-Data"]=l.initData),fetch(`${p}/join`,{method:"POST",headers:i,body:JSON.stringify(s)}).then(a=>(console.log("üîµ [MAIN.JS] –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",a.status,a.statusText),a.json())).then(a=>{if(console.log("üîµ [MAIN.JS] –î–∞–Ω–Ω—ã–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",a),!a.success)throw new Error(a.error||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");console.log("‚úÖ [MAIN.JS] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ:",a),t.registered=!0,console.log("üîµ [MAIN.JS] –í—ã–∑–æ–≤ showScreen('screen-gender')"),f("screen-gender"),l&&l.sendData&&l.sendData(JSON.stringify({action:"register",userId:s.userId}));const d=`https://t.me/SeligerTinderApp_bot?start=${s.userId}`;l&&l.openLink?l.openLink(d):window.open(d,"_blank")}).catch(a=>{console.error("‚ùå [MAIN.JS] –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:",a),alert("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: "+a.message)})}),console.log("‚úÖ [MAIN.JS] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ join-button —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")}else console.error("‚ùå [MAIN.JS] –ö–Ω–æ–ø–∫–∞ join-button –ù–ï –Ω–∞–π–¥–µ–Ω–∞!")}console.log("üîµ [MAIN.JS] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–∑–æ–≤–∞ setupJoinButton..."),console.log("  - document.readyState:",document.readyState),document.readyState==="loading"?(console.log("  üîµ [MAIN.JS] DOM –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∂–¥–µ–º DOMContentLoaded"),document.addEventListener("DOMContentLoaded",()=>{console.log("  ‚úÖ [MAIN.JS] DOMContentLoaded –ø—Ä–æ–∏–∑–æ—à–µ–ª, –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()})):(console.log("  ‚úÖ [MAIN.JS] DOM —É–∂–µ –≥–æ—Ç–æ–≤, –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton —Å—Ä–∞–∑—É"),A()),console.log("  üîµ [MAIN.JS] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫..."),setTimeout(()=>{console.log("  üîµ [MAIN.JS] –¢–∞–π–º–µ—Ä 500ms: –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()},500),setTimeout(()=>{console.log("  üîµ [MAIN.JS] –¢–∞–π–º–µ—Ä 1000ms: –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()},1e3),setTimeout(()=>{console.log("  üîµ [MAIN.JS] –¢–∞–π–º–µ—Ä 2000ms: –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()},2e3);const U=document.getElementById("maleBtn"),M=document.getElementById("femaleBtn");function Q(e){U&&M&&(e==="male"?(U.classList.add("active"),M.classList.remove("active")):e==="female"&&(M.classList.add("active"),U.classList.remove("active")),t.gender=e,console.log("–ü–æ–ª –≤—ã–±—Ä–∞–Ω: "+t.gender))}const Z=document.getElementById("continue-button");Z&&Z.addEventListener("click",async()=>{if(console.log("–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–ü–†–û–î–û–õ–ñ–ò–¢–¨', currentUser.gender = '"+t.gender+"'"),!t.gender||t.gender!=="male"&&t.gender!=="female"){alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø–æ–ª, –Ω–∞–∂–∞–≤ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫ '–ú–£–ñ–ß–ò–ù–ê' –∏–ª–∏ '–ñ–ï–ù–©–ò–ù–ê'.");return}if(!F)try{const o=await(await fetch(`${p}/updateGender`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,gender:t.gender,photoUrl:t.photoUrl})})).json();if(!o.success){if(o.error&&(o.error.includes("–º–µ–º")||o.error.includes("–ø–æ–ª")||o.error.includes("–ª–∏—Ü–æ"))){ze(o.error);return}alert("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞: "+o.error);return}await H()}catch(e){console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞:",e),alert("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞.");return}f("screen-swipe")}),U&&U.addEventListener("click",()=>Q("male")),M&&M.addEventListener("click",()=>Q("female"));const ee=document.getElementById("matches-button");ee&&ee.addEventListener("click",()=>{y(),f("screen-matches")});const te=document.getElementById("back-button");te&&te.addEventListener("click",()=>{console.log("‚ñ∂ Back –∏–∑ Matches -> –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ screen-swipe"),f("screen-swipe")});const oe=document.getElementById("profile-back-button");oe&&oe.addEventListener("click",()=>{_?(_=null,f("screen-matches")):(console.log("‚ñ∂ Back –∏–∑ Profile -> –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ screen-swipe"),f("screen-swipe"))});const $=document.getElementById("profile-edit-back-button");$&&($.style.padding="24px",$.style.margin="-24px",$.addEventListener("click",()=>{console.log("‚ñ∂ Back –∏–∑ Profile Edit -> –≤—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"),C()}));function Y(){return{reply_markup:{inline_keyboard:[[{text:"‚ú®–û—Ç–∫—Ä—ã—Ç—å Seliger Tinder‚ú®",web_app:{url:V}}],[{text:"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ",callback_data:"upload_photo"},{text:"–î–æ–±–∞–≤–∏—Ç—å –æ —Å–µ–±–µ",callback_data:"add_bio"}],[{text:"–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç",callback_data:"update_age"},{text:"–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",callback_data:"delete_user"}],[{text:"–ó–∞–ø—Ä–æ—Å–∏—Ç—å –±–µ–π–¥–∂",callback_data:"request_badge"}],[{text:"–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è/–û—à–∏–±–∫–∞/–ü—Ä–æ–±–ª–µ–º–∞",callback_data:"dev_message"}]]}}}const J=document.getElementById("tg-modal"),ne=document.getElementById("tg-modal-ok"),se=document.getElementById("tg-modal-cancel");function xe(){J&&(J.style.display="flex")}const re=document.getElementById("add-photo-btn");re&&re.addEventListener("click",xe);function ie(){J&&(J.style.display="none")}ne&&ne.addEventListener("click",async()=>{console.log("üåü specialPush triggered, payload:",{userId:t.userId,message:`–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1‚Äì3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º. üì∏‚ú®
–≠—Ç–æ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –º–∏–Ω—É—Ç—É!
`,keyboard:Y()});try{const o=await(await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,message:`–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1‚Äì3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º. üì∏‚ú®
–≠—Ç–æ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –º–∏–Ω—É—Ç—É!
`,keyboard:Y()})})).json();console.log("‚úÖ specialPush response:",o),o.success||console.error("Push error:",o.error)}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ /api/specialPush:",e)}ie()}),se&&se.addEventListener("click",ie);function v(){if(t.needPhoto===1){console.log('[showCandidate] needPhoto=1, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ"'),r.style.backgroundImage="none",r.style.backgroundColor="#fff",r.innerHTML=`
        <div class="no-users invite-wrapper">
          <h3>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1-3 —Ñ–æ—Ç–æ —Å –ª–∏—Ü–æ–º, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã.</h3>
          <button id="add-photo-swipe-btn" class="invite-button">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
        </div>
      `,r.style.boxShadow="none",document.querySelectorAll(".back-cnd-btn, .superlike_d, .like_d, .dislike_d").forEach(o=>o.style.display="none");const e=document.getElementById("add-photo-swipe-btn");if(e){const o=e.cloneNode(!0);e.parentNode.replaceChild(o,e),o.addEventListener("click",function(){window.handlePhotoAddition?window.handlePhotoAddition.call(o):console.warn("handlePhotoAddition –Ω–µ –Ω–∞–π–¥–µ–Ω")}),console.log("[showCandidate] –ö–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞, –Ω–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ handlePhotoAddition")}return}if(!u||u.length===0||I>=u.length){r.style.backgroundImage="none",r.style.backgroundColor="#fff",r.innerHTML=`
        <div class="no-users invite-wrapper">
          <h3>–ù–µ—Ç –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
          <button id="invite-button" class="invite-button">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>
      `,r.style.boxShadow="none",document.querySelectorAll(".like_d, .dislike_d").forEach(e=>e.style.display="none"),document.getElementById("invite-button").addEventListener("click",ae);return}Pe(r,u[I]),r.classList.remove("show-match","returning"),document.querySelectorAll(".like_d, .dislike_d").forEach(e=>e.style.display=t.needPhoto?"none":"flex")}function _e(){N=!0,r.style.transition="transform 0.5s ease",r.style.transform="translate(1000px, 0) rotate(45deg)",setTimeout(()=>{r.style.transition="transform 0.3s ease",r.style.transform="none",K(r);const e=r.querySelector(".badge-match");e&&(e.innerHTML="‚ù§Ô∏è‚Äçüî•",e.style.opacity="",e.style.transform="",e.classList.add("match-animation"),e.addEventListener("animationend",()=>{e.classList.remove("match-animation")},{once:!0})),"vibrate"in navigator&&navigator.vibrate([50,30,80,30,110,30,150]);const o=document.querySelector(".like_d"),n=document.querySelector(".dislike_d"),s=u.find(i=>String(i.id)===r.dataset.userId);o&&(o.style.display="flex",o.innerHTML='<img class="next" src="/img/next.svg" alt="next" />',o.onclick=()=>{D()}),n&&(n.style.display="flex",s&&s.username?(n.style.backgroundColor="#55a6ff",n.innerHTML='<img class="chat" src="/img/chat.svg" alt="chat" />',n.onclick=()=>window.open(`https://t.me/${s.username}`,"_blank")):(n.innerHTML="üëã",n.style.backgroundColor="#ff5e5e",n.style.fontSize="36px",n.onclick=async()=>{const i=n;try{(await(await fetch(`${p}/sendPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:t.userId,senderUsername:t.username||t.name,receiverId:s.id})})).json()).success&&(i.textContent="üëã",i.disabled=!0,i.style.backgroundColor="#ccc")}catch(a){console.error("‚ùå /api/sendPush –æ—à–∏–±–∫–∞:",a)}})),y()},500)}function ae(){const e="–ü—Ä–∏–≤–µ—Ç! –ù–∞—à—ë–ª —É–¥–æ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –º–µ–∂–¥—É —Å–æ—Å–µ–¥—è–º–∏ –Ω–∞—à–µ–≥–æ –ñ–ö.: https://t.me/SeligerTinderApp_bot/sta";navigator.share?navigator.share({text:e}):navigator.clipboard.writeText(e).then(()=>alert("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞")).catch(()=>alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç"))}let X=!1,le=0,ce=0,E=0,q=0;const Be=200,j=64,Le=128,Ae=100;r&&(r.addEventListener("pointerdown",e=>{I>=u.length||(X=!0,le=e.clientX,ce=e.clientY,r.setPointerCapture(e.pointerId),r.style.transition="none")}),r.addEventListener("pointermove",e=>{if(!X)return;E=e.clientX-le,q=e.clientY-ce;const o=E/200*20;r.style.transform=`translate(${E}px, ${q}px) rotate(${o}deg)`,r.style.boxShadow="0 8px 24px rgba(0,0,0,0.3)";const n=r.querySelector(".badge-like"),s=r.querySelector(".badge-nope");let i=Math.min(Math.abs(E)/Be,1),a=j+(Le-j)*i;E>0?(n&&(n.style.opacity=i,n.style.fontSize=a+"px"),s&&(s.style.opacity=0,s.style.fontSize=j+"px")):(s&&(s.style.opacity=i,s.style.fontSize=a+"px"),n&&(n.style.opacity=0,n.style.fontSize=j+"px"))}),r.addEventListener("pointerup",e=>{X=!1,r.releasePointerCapture(e.pointerId);const o=Math.abs(E),n=Math.abs(q);o<10&&n<10?Ue():o>Ae?(E>0?"right":"left")==="right"?ge():pe():(r.style.transition="transform 0.3s ease",r.style.transform="none",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",K(r),E=0,q=0)}));function Ue(){const e=r.dataset.photos?JSON.parse(r.dataset.photos):[];if(e.length<2)return;S=(S+1)%e.length,r.style.backgroundImage=`url('${e[S]}')`;const o=r.querySelector(".paginator");o&&z(o,e.length,S)}const de=document.querySelector(".like_d"),ue=document.querySelector(".dislike_d");de&&de.addEventListener("click",()=>{!u||u.length===0||I>=u.length?v():ge()}),ue&&ue.addEventListener("click",()=>{!u||u.length===0||I>=u.length?v():pe()});async function pe(){const e=r.dataset.userId,o=u.findIndex(n=>String(n.id)===String(e));if(o>=0)try{await fetch(`${p}/dislike`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e})})}catch(n){console.error("‚ùå /api/dislike –æ—à–∏–±–∫–∞:",n)}r.style.transition="transform 0.5s ease",r.style.transform="translate(-1000px, 0) rotate(-45deg)",setTimeout(()=>{o>=0&&u.splice(o,1),D(),y()},500)}async function y(){const e=document.getElementById("matches-count");if(e){if(F){e.textContent="2",e.style.display="inline-block";return}try{const o=`${p}/matches?userId=${t.userId}`,s=await(await fetch(o)).json();if(!s.success||!Array.isArray(s.data)){e.style.display="none";return}const i=s.data.length;e.textContent=i>0?i:"",e.style.display=i>0?"inline-block":"none"}catch(o){console.error("‚ùå updateMatchesCount:",o)}}}async function Me(){if(!t.gender)return;if(t.needPhoto===1){u=[],v(),y();return}const e=t.gender==="male"?"female":"male",o=`${p}/candidates?oppositeGender=${e}&userId=${t.userId}`;try{const s=await(await fetch(o)).json();if(s.success&&Array.isArray(s.data)){const i=new Set(t.likes),a=new Set(t.dislikes);u=s.data.filter(d=>!i.has(d.id)&&!a.has(d.id)&&Number(d.needPhoto||0)===0),I=0}v(),y()}catch(n){console.error("‚ùå loadCandidates:",n),u=[],v(),y()}}async function ge(){if(N){D();return}const e=r.dataset.userId,o=u.findIndex(n=>String(n.id)===String(e));if(!(o<0))try{const s=await(await fetch(`${p}/like`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e})})).json();s.success&&s.mutual?_e():(r.style.transition="transform 0.5s ease",r.style.transform="translate(1000px, 0) rotate(45deg)",setTimeout(()=>{u.splice(o,1),D(),y()},500))}catch(n){console.error("‚ùå /api/like –æ—à–∏–±–∫–∞:",n)}}function D(){if(N){const n=u.findIndex(s=>String(s.id)===r.dataset.userId);n>=0&&u.splice(n,1)}N=!1,r.style.transition="none",r.style.transform="none",K(r);const e=document.querySelector(".like_d"),o=document.querySelector(".dislike_d");e&&(e.innerHTML='<img class="like" src="/img/like.svg" alt="like" />',e.onclick=null,e.style.backgroundColor="",e.style.fontSize=""),o&&(o.innerHTML='<img class="dislike" src="/img/dislike.svg" alt="dislike" />',o.onclick=null,o.style.backgroundColor="",o.style.fontSize=""),document.querySelectorAll(".like_d, .dislike_d").forEach(n=>n.style.display="flex"),v()}function f(e){if(e==="screen-profile"&&_){document.querySelectorAll(".screen").forEach(n=>n.style.display="none"),document.getElementById("screen-profile").style.display="block",Je(_);return}document.querySelectorAll(".screen").forEach(n=>n.style.display="none");const o=document.getElementById(e);if(!o){console.error(`‚ùå –ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ —Å id="${e}"`);return}if(o.style.display="block",console.log(`‚ñ∂ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω: ${e}`),e==="screen-welcome"&&Ce(),e==="screen-gender"&&Te(),e==="screen-swipe"){Ne(),y();const n=document.querySelector("#screen-swipe .ava-frame");n&&(n.style.cursor="pointer",n.addEventListener("click",()=>{_=null,f("screen-profile")})),H().then(()=>{t.needPhoto===1?(u=[],v(),y()):Me()}).catch(s=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–≤–∞–π–ø–µ:",s))}if(e==="screen-matches"&&(y(),fe()),e==="screen-profile"){const n=document.querySelector("#screen-profile .profile-header h2");n&&(n.textContent="–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å");const s=document.getElementById("edit-profile-button");s&&(s.style.display="");const i=document.querySelector("#screen-profile .profile-actions");i&&i.remove();const a=document.getElementById("candidate-delete-btn");a&&a.remove(),H().then(()=>{$e();const d=document.getElementById("edit-profile-button");d&&(d.style.cursor="pointer",d.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø—Ä–æ—Ñ–∏–ª—è"),ye()}))}).catch(d=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",d))}}function Ce(){console.log("üîµ [MAIN.JS] updateWelcomeScreen –≤—ã–∑–≤–∞–Ω–∞"),console.log("  - currentUser:",t),console.log("  - currentUser.name:",t==null?void 0:t.name),T()}function Te(){const e=document.querySelector("#screen-gender .user-avatar-small"),o=document.querySelector("#screen-gender .user-id h3");e&&(e.src=t.photoUrl),o&&(o.textContent=t.name)}function Ne(){const e=document.querySelector("#screen-swipe .avatar_small_2"),o=document.querySelector("#screen-swipe .user-id2");e&&(e.src=t.photoUrl),o&&(o.innerHTML=`<span class="user-link">${t.name}</span>`)}function $e(){const e=document.getElementById("profileCard"),o=document.querySelector("#screen-profile .user-info"),n=document.querySelector("#screen-profile .user-bio"),s=document.querySelector("#screen-profile .paginator");if(e&&o){const w=o.querySelector(".badge-wrapper");w&&w.remove();const m=o.querySelector(".name-age-container .user-name");m&&(m.textContent=t.name);const b=o.querySelector(".name-age-container .user-age");if(b&&(!t.hideAge&&t.age?(b.textContent=`${t.age} –ª–µ—Ç`,b.style.display=""):b.style.display="none"),t.badge&&t.badge.trim()!==""){const k=document.createElement("div");k.className="badge-wrapper",k.innerHTML=`<img src="https://sta-black-dim.waw.amverum.cloud${t.badge}" alt="Badge" class="badge-image">`,o.prepend(k)}}n&&(n.textContent=t.bio);function i(w,m){s&&z(s,w,m)}let a=t.photos||[],d=0;e&&(e.style.backgroundImage=`url('${a.length>0?a[0]:"/img/photo.svg"}')`,e.onclick=()=>{a.length<2||(d=(d+1)%a.length,e.style.backgroundImage=`url('${a[d]}')`,i(a.length,d))}),i(a.length,0),window.renderProInfo&&window.renderProInfo(t)}async function fe(){const e=document.getElementById("matches-list");if(e){e.innerHTML="";try{const n=await(await fetch(`${p}/matches?userId=${t.userId}`)).json();if(!n.success){e.innerHTML="<p class='no-matches'>–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞—Ç—á–µ–π</p>";return}const s=n.data;if(!Array.isArray(s)||s.length===0){e.innerHTML=`
        <div class="no-matches invite-wrapper">
          <p>–ù–µ—Ç –º–∞—Ç—á–µ–π</p>
          <button id="invite-matches" class="invite-button">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>
      `,document.getElementById("invite-matches").addEventListener("click",ae);return}s.forEach(i=>{const a=i.avatar||"/img/logo.svg",d=document.createElement("div");d.className="match-card";let w="";i.username&&i.username.trim()!==""?w='<button class="match-write-btn">–ù–ê–ü–ò–°–ê–¢–¨</button>':i.pushSent?w='<button class="match-push-btn" disabled>–í–´ –ü–û–ú–ê–•–ê–õ–ò</button>':w='<button class="match-push-btn">–ü–û–ú–ê–•–ê–¢–¨ üëã</button>',d.innerHTML=`
        <div class="match-user">
          <img class="match-avatar" src="${a}" alt="${i.name}" />
          <span class="match-name">${i.name}${i.age?`, ${i.age}`:""}</span>
        </div>
        <div class="match-actions">
          ${w}
          <button class="match-gift-btn">
            <img src="/img/gift.svg" alt="gift" />
          </button>
        </div>
      `;const m=d.querySelector(".match-push-btn");m&&m.addEventListener("click",async()=>{if(!m.disabled)try{const L=await(await fetch(`${p}/sendPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:t.userId,senderUsername:t.username||t.name,receiverId:i.id})})).json();L.success?(m.textContent="–í–´ –ü–û–ú–ê–•–ê–õ–ò",m.disabled=!0,m.classList.add("match-push-sent")):alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push: "+L.error)}catch(P){console.error("‚ùå –û—à–∏–±–∫–∞ –≤ /api/sendPush:",P),alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push.")}});const b=d.querySelector(".match-write-btn");b&&b.addEventListener("click",()=>{window.open(`https://t.me/${i.username}`,"_blank")});const k=d.querySelector(".match-gift-btn");k&&k.addEventListener("click",()=>{c=i.id,showGiftModal()}),e.appendChild(d),d.querySelector(".match-user").addEventListener("click",()=>{_=i,f("screen-profile")})}),window.renderProInfo&&window.renderProInfo(t)}catch(o){console.error("‚ùå renderMatches:",o),e.innerHTML="<p class='no-matches'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π</p>"}}}function Je(e){_=e;const o=document.querySelector("#screen-profile .profile-header h2");o&&(o.textContent="–í–∞—à Match");const n=document.getElementById("profileCard"),s=e.photos&&e.photos.length>0?e.photos[0]:e.avatar||"/img/photo.svg";n.style.backgroundImage=`url('${s}')`;const i=document.querySelector("#screen-profile .name-age-container .user-name"),a=document.querySelector("#screen-profile .name-age-container .user-age");i&&(i.textContent=e.name),a&&(e.age?(a.textContent=`${e.age} –ª–µ—Ç`,a.style.display=""):a.style.display="none");const d=document.querySelector("#screen-profile .user-bio");d&&(d.textContent=e.bio||"");const w=document.querySelector("#screen-profile .paginator");z(w,(e.photos||[]).length,0);const m=document.getElementById("edit-profile-button");if(m){m.style.display="none";const P=document.querySelector("#screen-profile .profile-actions");P&&P.remove();const L=document.createElement("div");L.className="profile-actions",L.innerHTML=`
        <button id="candidate-write-btn">–ù–∞–ø–∏—Å–∞—Ç—å</button>
        <button id="candidate-gift-btn">–ü–æ–¥–∞—Ä–æ–∫</button>
      `,m.insertAdjacentElement("afterend",L);let x=document.getElementById("candidate-delete-btn");x&&x.remove(),x=document.createElement("button"),x.id="candidate-delete-btn",x.className="delete-match-btn",x.innerHTML='<img src="/img/unlike.svg" alt="–£–¥–∞–ª–∏—Ç—å" width="24" height="24" /> –£–¥–∞–ª–∏—Ç—å –ú—ç—Ç—á',n.appendChild(x),x.addEventListener("click",async()=>{try{await fetch(`${p}/like`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e.id})}),await fetch(`${p}/dislike`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e.id})}),await fe(),f("screen-matches"),y()}catch(je){console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –º–∞—Ç—á–µ–π:",je),window.Telegram.WebApp.showAlert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∏–∑ –ú—ç—Ç—á–µ–π")}})}const b=document.getElementById("candidate-write-btn");b&&(b.onclick=()=>{e.username?window.open(`https://t.me/${e.username}`,"_blank"):window.Telegram.WebApp.showAlert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª username")});const k=document.getElementById("candidate-gift-btn");k&&(k.onclick=()=>{c=e.id,showGiftModal()})}window.showGiftModal=function(){const e=document.querySelector(".gift-backdrop");e&&e.classList.add("open"),document.getElementById("gift-modal").classList.add("open")},window.hideGiftModal=function(){const e=document.querySelector(".gift-backdrop");e&&e.classList.remove("open"),document.getElementById("gift-modal").classList.remove("open")};function me(e){const o=document.createElement("div");o.textContent=e,Object.assign(o.style,{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"10px 20px",borderRadius:"25px",maxWidth:"100%",zIndex:"2100",pointerEvents:"none",opacity:"1",transition:"opacity 0.5s ease"}),document.body.appendChild(o),setTimeout(()=>{o.style.opacity="0",setTimeout(()=>o.remove(),500)},2e3)}window.handleGiftOrder=async function(e){var d,w;event.stopPropagation&&event.stopPropagation();const o=e.closest(".gift-card"),n=o.dataset.giftId,s=((d=o.querySelector(".gift-desc"))==null?void 0:d.textContent.trim())||"",i=((w=o.querySelector(".gift-price"))==null?void 0:w.textContent.trim())||"",a=c;try{const m={userId:t.userId,candidateId:a,giftId:n,message:`üéâ –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –£–≤–µ—Ä–µ–Ω, —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥—ë—Ç –æ—Ç–ª–∏—á–Ω–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ.
–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫: ${s} ‚Äî ${i}`},b={reply_markup:{inline_keyboard:[[{text:"–û–ø–ª–∞—Ç–∏—Ç—å",callback_data:`pay_${n}_${a}`}],[{text:"–û—Ç–º–µ–Ω–∞",callback_data:"cancel_special"}]]}};m.keyboard=b;const P=await(await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).json();P.success||console.error("–û—à–∏–±–∫–∞ specialPush:",P.error)}catch(m){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ specialPush:",m)}hideGiftModal(),me("–û—Ç–ø—Ä–∞–≤–∏–ª–∏ –ü—É—à")},document.getElementById("gift-modal-close").addEventListener("click",hideGiftModal);const he=document.getElementById("gift-detail-btn");he&&he.addEventListener("click",e=>{e.stopPropagation();const o=[`–ù–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–Ω–∞–∫–æ–º–∏—Ç –≤–∞—Å –Ω–µ —Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω, –Ω–æ –∏ –¥–∞—Ä–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏! üéÅ
–ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞–º–∏ –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞–ø—Ä—è–º—É—é –≤–∞—à–µ–º—É —Å–æ—Å–µ–¥—É: –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∞–¥—Ä–µ—Å ‚Äî –º—ã –≤—Å—ë –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –∏ –¥–æ—Å—Ç–∞–≤–∏–º –≤–∞—à –ø—Ä–µ–∑–µ–Ω—Ç —Ç–æ—á–Ω–æ –≤ —Ä—É–∫–∏.
–ü–µ—Ä–µ–¥ –¥–æ—Å—Ç–∞–≤–∫–æ–π –≤—ã—à–ª–µ–º —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç üì∏, –∞ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–º –≤—Ä—É—á–µ–Ω–∏–µ.
–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫ ‚Äî –≤–µ—Ä–Ω—ë–º –¥–µ–Ω—å–≥–∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.
`].join(`

`),n={reply_markup:{inline_keyboard:[[{text:"–ó–∞–∫–∞–∑–∞—Ç—å",callback_data:"order_now"}],[{text:"–û—Ç–º–µ–Ω–∞",callback_data:"cancel_special"}]]}};fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,message:o,keyboard:n})}).then(s=>s.json()).then(s=>{if(!s.success)throw new Error(s.error);console.log("push sent:",s)}).catch(s=>{console.error("‚ùå specialPush error:",s),alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.")}).finally(()=>{hideGiftModal(),me("–û—Ç–ø—Ä–∞–≤–∏–ª–∏ –ü—É—à")})});function ye(){const e=document.getElementById("profileCard"),o=document.querySelector("#screen-profile .user-info");if(!e||!o){console.error("–≠–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}e.style.transition="transform 0.4s ease",e.style.transformOrigin="top center",e.style.transform="scale(0.5)",o.style.transition="opacity 0.4s ease, transform 0.4s ease",o.style.opacity="0",o.style.transform="translateY(2vh)",setTimeout(()=>{f("screen-profile-edit"),ve()},400)}const B=document.getElementById("age-toggle-icon"),O=document.getElementById("edit-age-input"),R=document.querySelector(".age-label");B.classList.add("active"),B.style.backgroundImage="url('/img/eye_open.svg')",B.addEventListener("click",()=>{B.classList.toggle("active")?(B.style.backgroundImage="url('/img/eye_open.svg')",O.disabled=!1,O.style.filter="none",R&&(R.style.color=""),t.hideAge=!1):(B.style.backgroundImage="url('/img/eye_close.svg')",O.disabled=!0,O.style.filter="grayscale(100%)",R&&(R.style.color="#999"),t.hideAge=!0)});function C(){const e=document.getElementById("profileCard"),o=document.querySelector("#screen-profile .user-info"),n=document.getElementById("screen-profile-edit");if(!e||!o||!n){console.error("–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."),f("screen-profile");return}e.style.transition="transform 0.4s ease",e.style.transformOrigin="top center",e.style.transform="scale(1)",o.style.transition="opacity 0.4s ease, transform 0.4s ease",o.style.opacity="1",o.style.transform="translateY(0)",setTimeout(()=>{f("screen-profile"),n.style.display="none";const s=document.querySelector("#screen-profile .gradient-card");s&&(s.style.transition="opacity 0.3s ease",s.style.opacity="0",setTimeout(()=>{s.style.opacity="1"},100)),o&&(o.style.transition="opacity 0.3s ease, transform 0.3s ease",o.style.opacity="0",o.style.transform="translateY(20px)",setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(0)"},100))},400)}window.exitProfileEditMode=C,typeof G<"u"&&G.exports&&(G.exports.exitProfileEditMode=C);const we=document.getElementById("screen-profile");we&&we.querySelectorAll(".edit-button").forEach(e=>{e.style.cursor="pointer",e.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'"),ye()})});const be=document.getElementById("edit-cancel-button"),Ie=document.getElementById("edit-save-button");be&&be.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–û—Ç–º–µ–Ω–∞'"),C()}),Ie&&Ie.addEventListener("click",()=>{const e=document.getElementById("edit-bio-input"),o=document.getElementById("edit-age-input"),n=e.value.trim();let s=null;if(!t.hideAge&&(s=parseInt(o.value,10),isNaN(s)||s<1||s>99)){alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç (–æ—Ç 1 –¥–æ 99)");return}const i={userId:t.userId,bio:n,age:s,photos:t.photos};fetch(`${p}/updateProfile`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(a=>a.json()).then(a=>{if(!a.success){alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: "+a.error);return}t.bio=n,t.age=s,C()}).catch(a=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:",a),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è")})});async function qe(){if(F)return!1;try{const o=await(await fetch(`${p}/users`)).json();if(console.log("üîç checkIfRegistered response:",o),!o.success||!Array.isArray(o.data))return console.warn("‚ùå checkIfRegistered: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞"),!1;const n=o.data.find(s=>String(s.userId)===t.userId);if(console.log("üîç checkIfRegistered: –∏—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",t.userId,"–Ω–∞–π–¥–µ–Ω:",!!n),!n)return!1;t.registered=!0,t.gender=n.gender,t.bio=n.bio,t.age=n.age,t.photos=[],n.photo1&&t.photos.push(n.photo1),n.photo2&&t.photos.push(n.photo2),n.photo3&&t.photos.push(n.photo3),t.photos.length===0&&t.photos.push(n.photoUrl||"/img/logo.svg"),t.photoUrl=t.photos[0],t.username=n.username||t.username,t.likes=JSON.parse(n.likes||"[]"),t.dislikes=JSON.parse(n.dislikes||"[]"),t.badge=n.badge||"",t.needPhoto=Number(n.needPhoto||0);try{const i=await(await fetch(`${p}/goals?userId=${t.userId}`)).json();i.success?t.goals=i.goals||[]:t.goals=[]}catch(s){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–π –≤ checkIfRegistered:",s),t.goals=[]}return window.currentUser=t,T(),console.log("‚úÖ checkIfRegistered: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"),!0}catch(e){return console.error("‚ùå checkIfRegistered:",e),!1}}y();async function H(){if(!F)try{const o=await(await fetch(`${p}/getUser?userId=${t.userId}`)).json();if(!o.success)return;const n=o.data;t.name=n.name||t.name,t.username=n.username||t.username,t.gender=n.gender,t.bio=n.bio||t.bio,t.age=n.age||t.age,t.photos=[],n.photo1&&t.photos.push(n.photo1),n.photo2&&t.photos.push(n.photo2),n.photo3&&t.photos.push(n.photo3),t.photos.length===0&&t.photos.push(n.photoUrl||"/img/logo.svg"),t.photoUrl=t.photos[0],t.likes=JSON.parse(n.likes||"[]"),t.dislikes=JSON.parse(n.dislikes||"[]"),t.badge=n.badge||"",t.needPhoto=Number(n.needPhoto||0),t.is_pro=Number(n.is_pro)===1,t.pro_end=n.pro_end;try{const i=await(await fetch(`${p}/goals?userId=${t.userId}`)).json();i.success?t.goals=i.goals||[]:t.goals=[]}catch(s){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–π:",s),t.goals=[]}window.currentUser=t,T(),window.initProFeatures&&window.initProFeatures(t)}catch(e){console.error("‚ùå loadUserData:",e)}}(async function(){console.log("‚ñ∂ initFlow()..."),console.log("üîç currentUser.userId:",t.userId);const o=await qe();if(console.log("üîç checkIfRegistered —Ä–µ–∑—É–ª—å—Ç–∞—Ç:",o),!o){console.log("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º welcome"),f("screen-welcome");return}console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ"),await H(),t.gender?(console.log("üîç –ü–æ–ª –∑–∞–¥–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å–≤–∞–π–ø–æ–≤"),f("screen-swipe"),y()):(console.log("üîç –ü–æ–ª –Ω–µ –∑–∞–¥–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞"),f("screen-gender"))})(),y(),setInterval(async()=>{if(t.needPhoto===1)try{await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,message:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ, –¥–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —É–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.",keyboard:Y()})})}catch(e){console.error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–ø—É—à–∞ needPhoto:",e)}},5*60*1e3),W=f,console.log("üîµ [MAIN.JS] –ó–∞–º–µ–Ω—è–µ–º window.showScreen –Ω–∞ –Ω–∞—Å—Ç–æ—è—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é..."),window.showScreen=f,console.log("  ‚úÖ window.showScreen –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –Ω–∞—Å—Ç–æ—è—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:",typeof window.showScreen),console.log("  - showScreenImpl:",typeof W),typeof v<"u"&&(window.showCandidate=v,console.log("  ‚úÖ window.showCandidate —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"))});function K(c){const g=c.querySelector(".badge-like"),h=c.querySelector(".badge-nope");g&&(g.style.opacity=0),h&&(h.style.opacity=0)}function ze(c){const g=document.createElement("div");g.className="photo-error-modal",g.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    `;const h=document.createElement("div");h.style.cssText=`
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin: 20px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    `;const r=document.createElement("h3");r.textContent="–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ç–æ",r.style.cssText=`
      margin: 0 0 16px 0;
      color: #333;
      font-size: 18px;
    `;const u=document.createElement("p");u.textContent=c,u.style.cssText=`
      margin: 0 0 24px 0;
      color: #666;
      line-height: 1.5;
    `;const I=document.createElement("button");I.textContent="–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ",I.style.cssText=`
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 12px;
    `,I.onclick=()=>{document.body.removeChild(g),showTelegramModal()};const S=document.createElement("button");S.textContent="–û—Ç–º–µ–Ω–∞",S.style.cssText=`
      background: #F2F2F7;
      color: #007AFF;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
    `,S.onclick=()=>{document.body.removeChild(g)},h.appendChild(r),h.appendChild(u),h.appendChild(I),h.appendChild(S),g.appendChild(h),document.body.appendChild(g)}});export default Ge();
