var Je=(c,f)=>()=>(f||c((f={exports:{}}).exports,f),f.exports);import{i as Ie,_ as qe}from"./card.BorwUCbp.js";import{r as je,i as De}from"./pro.LCHVUHva.js";import{s as Oe,i as Re}from"./pro-modal.Deig-JMx.js";import"./utils.DE1O8Krf.js";import"./api.u-GyJUGh.js";import"./gift.IGWJdFdP.js";var We=Je((Ze,z)=>{window.initProfileEditScreen=Ie;window.renderProInfo=je;window.initProFeatures=De;window.showProModal=Oe;window.initProModalHandlers=Re;let l=null;window.Telegram&&window.Telegram.WebApp?(l=window.Telegram.WebApp,l.expand(),l.setHeaderColor("#ffffff"),l.setBackgroundColor("#f4f4f4"),console.log("‚úÖ Telegram.WebApp –ø–æ–¥–∫–ª—é—á–µ–Ω:",l),console.log("‚ÑπÔ∏è tg.initData:",l.initData),console.log("‚ÑπÔ∏è tg.initDataUnsafe:",l.initDataUnsafe)):console.warn("‚ö† Telegram.WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π/–ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º?)");const p="https://sta-black-dim.waw.amverum.cloud/api",F=window.location.hostname==="localhost",He=typeof window<"u"&&window.WEB_APP_URL?window.WEB_APP_URL:"https://sta-black-dim.waw.amverum.cloud";let U=null,t={userId:"UserID",name:"Username",username:"",photoUrl:"/img/logo.svg",gender:"",bio:"",age:0,photos:[],registered:!1,likes:[],dislikes:[],badge:"",needPhoto:0,hideAge:!1,API_URL:p};console.log("‚ÑπÔ∏è –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π currentUser:",t);console.log("üîç tg –æ–±—ä–µ–∫—Ç:",l);console.log("üîç tg.initDataUnsafe:",l==null?void 0:l.initDataUnsafe);var be;console.log("üîç tg.initDataUnsafe.user:",(be=l==null?void 0:l.initDataUnsafe)==null?void 0:be.user);var ke;if(l&&l.initDataUnsafe&&l.initDataUnsafe.user){const c=l.initDataUnsafe.user;console.log("‚ÑπÔ∏è tg.initDataUnsafe.user =",c),console.log("üîç u.id:",c.id,"—Ç–∏–ø:",typeof c.id),console.log("üîç u.first_name:",c.first_name,"—Ç–∏–ø:",typeof c.first_name),console.log("üîç u.username:",c.username,"—Ç–∏–ø:",typeof c.username),console.log("üîç u.photo_url:",c.photo_url,"—Ç–∏–ø:",typeof c.photo_url),t.userId=String(c.id||"UserID"),t.name=c.first_name||"Username",t.username=c.username||"",c.photo_url&&c.photo_url.startsWith("http")&&(t.photoUrl=c.photo_url),console.log("‚úÖ currentUser –æ–±–Ω–æ–≤–ª—ë–Ω –∏–∑ tg.initDataUnsafe:",t)}else console.warn("‚ö† –ù–µ –ø–æ–ª—É—á–∏–ª–∏ initDataUnsafe.user ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É"),console.log("üîç tg:",!!l),console.log("üîç tg.initDataUnsafe:",!!(l!=null&&l.initDataUnsafe)),console.log("üîç tg.initDataUnsafe.user:",!!((ke=l==null?void 0:l.initDataUnsafe)!=null&&ke.user));function W(c,f,h){if(c.innerHTML="",f<2){c.style.display="none";return}c.style.display="flex";for(let i=0;i<f;i++){const d=document.createElement("div");d.className=i===h?"pag_active":"pag",c.appendChild(d)}}console.log("üîµ [MAIN.JS] –°–∫—Ä–∏–ø—Ç main.js –∑–∞–≥—Ä—É–∂–µ–Ω (–¥–æ DOMContentLoaded)");console.log("  - document.readyState:",document.readyState);console.log("  - window.API_URL:",window.API_URL);console.log("  - window.API_BASE_URL:",window.API_BASE_URL);document.addEventListener("DOMContentLoaded",()=>{console.log("‚ñ∂ [MAIN.JS] DOMContentLoaded: init main.js..."),console.log("  - document.readyState:",document.readyState),console.log("  - API_URL:",p),console.log("  - currentUser:",t),console.log("  - typeof showScreen:",typeof g),U=g,console.log("  - showScreenImpl —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",typeof U);let c=null;const f=document.getElementById("gift-modal");f&&f.classList.remove("open");const h=document.querySelector(".gift-backdrop");h&&h.classList.remove("open");const i=document.getElementById("singleCard");let d=[],k=0,I=0,N=!1,B=null;console.log("üîµ [MAIN.JS] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º window.showScreen..."),window.showScreen=g,console.log("  ‚úÖ window.showScreen —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",typeof window.showScreen),console.log("üîµ [MAIN.JS] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º window.currentUser..."),window.currentUser=t,console.log("  ‚úÖ window.currentUser —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",window.currentUser),console.log("üîµ [MAIN.JS] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º window.API_URL..."),window.API_URL=p,console.log("  ‚úÖ window.API_URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:",window.API_URL),window.showCandidate=v,qe(()=>import("./user-actions.DbKfUyWR.js"),[]).then(e=>{window.handlePhotoAddition=e.handlePhotoAddition,console.log("‚úÖ handlePhotoAddition –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å")}).catch(e=>{console.warn("‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å handlePhotoAddition:",e)});function Se(e,n){let o=(n.photos||[]).filter(s=>s&&s.trim()!=="");o.length===0&&(o=["/img/photo.svg"]),e.style.backgroundImage=`url('${o[0]}')`,e.dataset.photos=JSON.stringify(o),I=0,e.dataset.userId=n.id,e.innerHTML=`
    <div class="gradient-card"></div>
    <div class="user-info">
      ${n.badge?`<div class="badge-wrapper"><img src="https://sta-black-dim.waw.amverum.cloud${n.badge}" class="badge-image"></div>`:""}
      <div class="name-age-container">
        <span class="user-name">${n.name}</span>
        ${!t.hideAge&&n.age?`<span class="user-age">${n.age} –ª–µ—Ç</span>`:""}
      </div>
      <p class="user-bio">${n.bio||""}</p>
      <div class="paginator"></div>
    </div>
    <div class="card-badge badge-like">üòç</div>
    <div class="card-badge badge-nope">üö´</div>
    <div class="card-badge badge-match"></div>
  `,W(e.querySelector(".paginator"),o.length,0)}function A(){console.log("üîµ [MAIN.JS] setupJoinButton –≤—ã–∑–≤–∞–Ω–∞"),console.log("  - document.readyState:",document.readyState),console.log("  - API_URL:",p),console.log("  - typeof showScreen:",typeof g),console.log("  - currentUser:",t),console.log("  - window.showScreen:",typeof window.showScreen),console.log("  - window.currentUser:",window.currentUser);const e=document.getElementById("join-button");if(e){if(console.log("‚úÖ [MAIN.JS] –ö–Ω–æ–ø–∫–∞ join-button –Ω–∞–π–¥–µ–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫"),console.log("  - joinButton:",e),console.log("  - joinButton.onclick:",e.onclick),e.getAttribute("data-main-handler")==="true"){console.log("  ‚ö†Ô∏è [MAIN.JS] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º");return}e.setAttribute("data-main-handler","true"),console.log("  üîµ [MAIN.JS] –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ click..."),e.addEventListener("click",()=>{console.log("üîµ [MAIN.JS] –ö–ª–∏–∫ –ø–æ join-button - –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏");let o={};l&&l.initDataUnsafe&&l.initDataUnsafe.user?(o=l.initDataUnsafe.user,console.log("  - tgUser –∏–∑ initDataUnsafe:",o)):console.warn("  ‚ö†Ô∏è tg.initDataUnsafe.user –Ω–µ –Ω–∞–π–¥–µ–Ω");const s={userId:String(o.id||"UserID"),name:o.first_name||"Username",username:o.username||"",photoUrl:o.photo_url&&o.photo_url.startsWith("http")?o.photo_url:"/img/logo.svg",gender:"",bio:""};console.log("üîµ [MAIN.JS] –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏:",s),console.log("  - URL:",`${p}/join`),fetch(`${p}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(r=>(console.log("üîµ [MAIN.JS] –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",r.status,r.statusText),r.json())).then(r=>{if(console.log("üîµ [MAIN.JS] –î–∞–Ω–Ω—ã–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",r),!r.success)throw new Error(r.error||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");console.log("‚úÖ [MAIN.JS] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ:",r),t.registered=!0,console.log("üîµ [MAIN.JS] –í—ã–∑–æ–≤ showScreen('screen-gender')"),g("screen-gender"),l&&l.sendData&&l.sendData(JSON.stringify({action:"register",userId:s.userId}));const a=`https://t.me/SeligerTinderApp_bot?start=${s.userId}`;l&&l.openLink?l.openLink(a):window.open(a,"_blank")}).catch(r=>{console.error("‚ùå [MAIN.JS] –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:",r),alert("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: "+r.message)})}),console.log("‚úÖ [MAIN.JS] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ join-button —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")}else console.error("‚ùå [MAIN.JS] –ö–Ω–æ–ø–∫–∞ join-button –ù–ï –Ω–∞–π–¥–µ–Ω–∞!")}console.log("üîµ [MAIN.JS] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–∑–æ–≤–∞ setupJoinButton..."),console.log("  - document.readyState:",document.readyState),document.readyState==="loading"?(console.log("  üîµ [MAIN.JS] DOM –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –∂–¥–µ–º DOMContentLoaded"),document.addEventListener("DOMContentLoaded",()=>{console.log("  ‚úÖ [MAIN.JS] DOMContentLoaded –ø—Ä–æ–∏–∑–æ—à–µ–ª, –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()})):(console.log("  ‚úÖ [MAIN.JS] DOM —É–∂–µ –≥–æ—Ç–æ–≤, –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton —Å—Ä–∞–∑—É"),A()),console.log("  üîµ [MAIN.JS] –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫..."),setTimeout(()=>{console.log("  üîµ [MAIN.JS] –¢–∞–π–º–µ—Ä 500ms: –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()},500),setTimeout(()=>{console.log("  üîµ [MAIN.JS] –¢–∞–π–º–µ—Ä 1000ms: –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()},1e3),setTimeout(()=>{console.log("  üîµ [MAIN.JS] –¢–∞–π–º–µ—Ä 2000ms: –≤—ã–∑—ã–≤–∞–µ–º setupJoinButton"),A()},2e3);const M=document.getElementById("maleBtn"),C=document.getElementById("femaleBtn");function K(e){M&&C&&(e==="male"?(M.classList.add("active"),C.classList.remove("active")):e==="female"&&(C.classList.add("active"),M.classList.remove("active")),t.gender=e,console.log("–ü–æ–ª –≤—ã–±—Ä–∞–Ω: "+t.gender))}const V=document.getElementById("continue-button");V&&V.addEventListener("click",async()=>{if(console.log("–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–ü–†–û–î–û–õ–ñ–ò–¢–¨', currentUser.gender = '"+t.gender+"'"),!t.gender||t.gender!=="male"&&t.gender!=="female"){alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø–æ–ª, –Ω–∞–∂–∞–≤ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫ '–ú–£–ñ–ß–ò–ù–ê' –∏–ª–∏ '–ñ–ï–ù–©–ò–ù–ê'.");return}if(!F)try{const n=await(await fetch(`${p}/updateGender`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,gender:t.gender,photoUrl:t.photoUrl})})).json();if(!n.success){if(n.error&&(n.error.includes("–º–µ–º")||n.error.includes("–ø–æ–ª")||n.error.includes("–ª–∏—Ü–æ"))){Fe(n.error);return}alert("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞: "+n.error);return}await H()}catch(e){console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞:",e),alert("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞.");return}g("screen-swipe")}),M&&M.addEventListener("click",()=>K("male")),C&&C.addEventListener("click",()=>K("female"));const Q=document.getElementById("matches-button");Q&&Q.addEventListener("click",()=>{y(),g("screen-matches")});const Z=document.getElementById("back-button");Z&&Z.addEventListener("click",()=>{console.log("‚ñ∂ Back –∏–∑ Matches -> –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ screen-swipe"),g("screen-swipe")});const ee=document.getElementById("profile-back-button");ee&&ee.addEventListener("click",()=>{B?(B=null,g("screen-matches")):(console.log("‚ñ∂ Back –∏–∑ Profile -> –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ screen-swipe"),g("screen-swipe"))});const $=document.getElementById("profile-edit-back-button");$&&($.style.padding="24px",$.style.margin="-24px",$.addEventListener("click",()=>{console.log("‚ñ∂ Back –∏–∑ Profile Edit -> –≤—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"),T()}));function G(){return{reply_markup:{inline_keyboard:[[{text:"‚ú®–û—Ç–∫—Ä—ã—Ç—å Seliger Tinder‚ú®",web_app:{url:He}}],[{text:"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ",callback_data:"upload_photo"},{text:"–î–æ–±–∞–≤–∏—Ç—å –æ —Å–µ–±–µ",callback_data:"add_bio"}],[{text:"–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç",callback_data:"update_age"},{text:"–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",callback_data:"delete_user"}],[{text:"–ó–∞–ø—Ä–æ—Å–∏—Ç—å –±–µ–π–¥–∂",callback_data:"request_badge"}],[{text:"–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è/–û—à–∏–±–∫–∞/–ü—Ä–æ–±–ª–µ–º–∞",callback_data:"dev_message"}]]}}}const J=document.getElementById("tg-modal"),te=document.getElementById("tg-modal-ok"),oe=document.getElementById("tg-modal-cancel");function ve(){J&&(J.style.display="flex")}const ne=document.getElementById("add-photo-btn");ne&&ne.addEventListener("click",ve);function se(){J&&(J.style.display="none")}te&&te.addEventListener("click",async()=>{console.log("üåü specialPush triggered, payload:",{userId:t.userId,message:`–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1‚Äì3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º. üì∏‚ú®
–≠—Ç–æ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –º–∏–Ω—É—Ç—É!
`,keyboard:G()});try{const n=await(await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,message:`–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1‚Äì3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º. üì∏‚ú®
–≠—Ç–æ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –º–∏–Ω—É—Ç—É!
`,keyboard:G()})})).json();console.log("‚úÖ specialPush response:",n),n.success||console.error("Push error:",n.error)}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ /api/specialPush:",e)}se()}),oe&&oe.addEventListener("click",se);function v(){if(t.needPhoto===1){console.log('[showCandidate] needPhoto=1, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ"'),i.style.backgroundImage="none",i.style.backgroundColor="#fff",i.innerHTML=`
        <div class="no-users invite-wrapper">
          <h3>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1-3 —Ñ–æ—Ç–æ —Å –ª–∏—Ü–æ–º, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã.</h3>
          <button id="add-photo-swipe-btn" class="invite-button">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
        </div>
      `,i.style.boxShadow="none",document.querySelectorAll(".back-cnd-btn, .superlike_d, .like_d, .dislike_d").forEach(n=>n.style.display="none");const e=document.getElementById("add-photo-swipe-btn");if(e){const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",function(){window.handlePhotoAddition?window.handlePhotoAddition.call(n):console.warn("handlePhotoAddition –Ω–µ –Ω–∞–π–¥–µ–Ω")}),console.log("[showCandidate] –ö–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞, –Ω–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ handlePhotoAddition")}return}if(!d||d.length===0||k>=d.length){i.style.backgroundImage="none",i.style.backgroundColor="#fff",i.innerHTML=`
        <div class="no-users invite-wrapper">
          <h3>–ù–µ—Ç –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
          <button id="invite-button" class="invite-button">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>
      `,i.style.boxShadow="none",document.querySelectorAll(".like_d, .dislike_d").forEach(e=>e.style.display="none"),document.getElementById("invite-button").addEventListener("click",re);return}Se(i,d[k]),i.classList.remove("show-match","returning"),document.querySelectorAll(".like_d, .dislike_d").forEach(e=>e.style.display=t.needPhoto?"none":"flex")}function Ee(){N=!0,i.style.transition="transform 0.5s ease",i.style.transform="translate(1000px, 0) rotate(45deg)",setTimeout(()=>{i.style.transition="transform 0.3s ease",i.style.transform="none",X(i);const e=i.querySelector(".badge-match");e&&(e.innerHTML="‚ù§Ô∏è‚Äçüî•",e.style.opacity="",e.style.transform="",e.classList.add("match-animation"),e.addEventListener("animationend",()=>{e.classList.remove("match-animation")},{once:!0})),"vibrate"in navigator&&navigator.vibrate([50,30,80,30,110,30,150]);const n=document.querySelector(".like_d"),o=document.querySelector(".dislike_d"),s=d.find(r=>String(r.id)===i.dataset.userId);n&&(n.style.display="flex",n.innerHTML='<img class="next" src="/img/next.svg" alt="next" />',n.onclick=()=>{D()}),o&&(o.style.display="flex",s&&s.username?(o.style.backgroundColor="#55a6ff",o.innerHTML='<img class="chat" src="/img/chat.svg" alt="chat" />',o.onclick=()=>window.open(`https://t.me/${s.username}`,"_blank")):(o.innerHTML="üëã",o.style.backgroundColor="#ff5e5e",o.style.fontSize="36px",o.onclick=async()=>{const r=o;try{(await(await fetch(`${p}/sendPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:t.userId,senderUsername:t.username||t.name,receiverId:s.id})})).json()).success&&(r.textContent="üëã",r.disabled=!0,r.style.backgroundColor="#ccc")}catch(a){console.error("‚ùå /api/sendPush –æ—à–∏–±–∫–∞:",a)}})),y()},500)}function re(){const e="–ü—Ä–∏–≤–µ—Ç! –ù–∞—à—ë–ª —É–¥–æ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –º–µ–∂–¥—É —Å–æ—Å–µ–¥—è–º–∏ –Ω–∞—à–µ–≥–æ –ñ–ö.: https://t.me/SeligerTinderApp_bot/sta";navigator.share?navigator.share({text:e}):navigator.clipboard.writeText(e).then(()=>alert("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞")).catch(()=>alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç"))}let Y=!1,ie=0,ae=0,E=0,q=0;const xe=200,j=64,Pe=128,Be=100;i&&(i.addEventListener("pointerdown",e=>{k>=d.length||(Y=!0,ie=e.clientX,ae=e.clientY,i.setPointerCapture(e.pointerId),i.style.transition="none")}),i.addEventListener("pointermove",e=>{if(!Y)return;E=e.clientX-ie,q=e.clientY-ae;const n=E/200*20;i.style.transform=`translate(${E}px, ${q}px) rotate(${n}deg)`,i.style.boxShadow="0 8px 24px rgba(0,0,0,0.3)";const o=i.querySelector(".badge-like"),s=i.querySelector(".badge-nope");let r=Math.min(Math.abs(E)/xe,1),a=j+(Pe-j)*r;E>0?(o&&(o.style.opacity=r,o.style.fontSize=a+"px"),s&&(s.style.opacity=0,s.style.fontSize=j+"px")):(s&&(s.style.opacity=r,s.style.fontSize=a+"px"),o&&(o.style.opacity=0,o.style.fontSize=j+"px"))}),i.addEventListener("pointerup",e=>{Y=!1,i.releasePointerCapture(e.pointerId);const n=Math.abs(E),o=Math.abs(q);n<10&&o<10?Le():n>Be?(E>0?"right":"left")==="right"?ue():de():(i.style.transition="transform 0.3s ease",i.style.transform="none",i.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",X(i),E=0,q=0)}));function Le(){const e=i.dataset.photos?JSON.parse(i.dataset.photos):[];if(e.length<2)return;I=(I+1)%e.length,i.style.backgroundImage=`url('${e[I]}')`;const n=i.querySelector(".paginator");n&&W(n,e.length,I)}const le=document.querySelector(".like_d"),ce=document.querySelector(".dislike_d");le&&le.addEventListener("click",()=>{!d||d.length===0||k>=d.length?v():ue()}),ce&&ce.addEventListener("click",()=>{!d||d.length===0||k>=d.length?v():de()});async function de(){const e=i.dataset.userId,n=d.findIndex(o=>String(o.id)===String(e));if(n>=0)try{await fetch(`${p}/dislike`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e})})}catch(o){console.error("‚ùå /api/dislike –æ—à–∏–±–∫–∞:",o)}i.style.transition="transform 0.5s ease",i.style.transform="translate(-1000px, 0) rotate(-45deg)",setTimeout(()=>{n>=0&&d.splice(n,1),D(),y()},500)}async function y(){const e=document.getElementById("matches-count");if(e){if(F){e.textContent="2",e.style.display="inline-block";return}try{const n=`${p}/matches?userId=${t.userId}`,s=await(await fetch(n)).json();if(!s.success||!Array.isArray(s.data)){e.style.display="none";return}const r=s.data.length;e.textContent=r>0?r:"",e.style.display=r>0?"inline-block":"none"}catch(n){console.error("‚ùå updateMatchesCount:",n)}}}async function _e(){if(!t.gender)return;if(t.needPhoto===1){d=[],v(),y();return}const e=t.gender==="male"?"female":"male",n=`${p}/candidates?oppositeGender=${e}&userId=${t.userId}`;try{const s=await(await fetch(n)).json();if(s.success&&Array.isArray(s.data)){const r=new Set(t.likes),a=new Set(t.dislikes);d=s.data.filter(u=>!r.has(u.id)&&!a.has(u.id)&&Number(u.needPhoto||0)===0),k=0}v(),y()}catch(o){console.error("‚ùå loadCandidates:",o),d=[],v(),y()}}async function ue(){if(N){D();return}const e=i.dataset.userId,n=d.findIndex(o=>String(o.id)===String(e));if(!(n<0))try{const s=await(await fetch(`${p}/like`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e})})).json();s.success&&s.mutual?Ee():(i.style.transition="transform 0.5s ease",i.style.transform="translate(1000px, 0) rotate(45deg)",setTimeout(()=>{d.splice(n,1),D(),y()},500))}catch(o){console.error("‚ùå /api/like –æ—à–∏–±–∫–∞:",o)}}function D(){if(N){const o=d.findIndex(s=>String(s.id)===i.dataset.userId);o>=0&&d.splice(o,1)}N=!1,i.style.transition="none",i.style.transform="none",X(i);const e=document.querySelector(".like_d"),n=document.querySelector(".dislike_d");e&&(e.innerHTML='<img class="like" src="/img/like.svg" alt="like" />',e.onclick=null,e.style.backgroundColor="",e.style.fontSize=""),n&&(n.innerHTML='<img class="dislike" src="/img/dislike.svg" alt="dislike" />',n.onclick=null,n.style.backgroundColor="",n.style.fontSize=""),document.querySelectorAll(".like_d, .dislike_d").forEach(o=>o.style.display="flex"),v()}function g(e){if(e==="screen-profile"&&B){document.querySelectorAll(".screen").forEach(o=>o.style.display="none"),document.getElementById("screen-profile").style.display="block",Ue(B);return}document.querySelectorAll(".screen").forEach(o=>o.style.display="none");const n=document.getElementById(e);if(!n){console.error(`‚ùå –ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ —Å id="${e}"`);return}if(n.style.display="block",console.log(`‚ñ∂ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω: ${e}`),e==="screen-welcome"&&Ae(),e==="screen-gender"&&Me(),e==="screen-swipe"){Ce(),y();const o=document.querySelector("#screen-swipe .ava-frame");o&&(o.style.cursor="pointer",o.addEventListener("click",()=>{B=null,g("screen-profile")})),H().then(()=>{t.needPhoto===1?(d=[],v(),y()):_e()}).catch(s=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–≤–∞–π–ø–µ:",s))}if(e==="screen-matches"&&(y(),pe()),e==="screen-profile"){const o=document.querySelector("#screen-profile .profile-header h2");o&&(o.textContent="–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å");const s=document.getElementById("edit-profile-button");s&&(s.style.display="");const r=document.querySelector("#screen-profile .profile-actions");r&&r.remove();const a=document.getElementById("candidate-delete-btn");a&&a.remove(),H().then(()=>{Te();const u=document.getElementById("edit-profile-button");u&&(u.style.cursor="pointer",u.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø—Ä–æ—Ñ–∏–ª—è"),me()}))}).catch(u=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",u))}}function Ae(){const e=document.querySelector("#screen-welcome .user-name");e&&(e.textContent=t.name)}function Me(){const e=document.querySelector("#screen-gender .user-avatar-small"),n=document.querySelector("#screen-gender .user-id h3");e&&(e.src=t.photoUrl),n&&(n.textContent=t.name)}function Ce(){const e=document.querySelector("#screen-swipe .avatar_small_2"),n=document.querySelector("#screen-swipe .user-id2");e&&(e.src=t.photoUrl),n&&(n.innerHTML=`<span class="user-link">${t.name}</span>`)}function Te(){const e=document.getElementById("profileCard"),n=document.querySelector("#screen-profile .user-info"),o=document.querySelector("#screen-profile .user-bio"),s=document.querySelector("#screen-profile .paginator");if(e&&n){const w=n.querySelector(".badge-wrapper");w&&w.remove();const m=n.querySelector(".name-age-container .user-name");m&&(m.textContent=t.name);const b=n.querySelector(".name-age-container .user-age");if(b&&(!t.hideAge&&t.age?(b.textContent=`${t.age} –ª–µ—Ç`,b.style.display=""):b.style.display="none"),t.badge&&t.badge.trim()!==""){const S=document.createElement("div");S.className="badge-wrapper",S.innerHTML=`<img src="https://sta-black-dim.waw.amverum.cloud${t.badge}" alt="Badge" class="badge-image">`,n.prepend(S)}}o&&(o.textContent=t.bio);function r(w,m){s&&W(s,w,m)}let a=t.photos||[],u=0;e&&(e.style.backgroundImage=`url('${a.length>0?a[0]:"/img/photo.svg"}')`,e.onclick=()=>{a.length<2||(u=(u+1)%a.length,e.style.backgroundImage=`url('${a[u]}')`,r(a.length,u))}),r(a.length,0),window.renderProInfo&&window.renderProInfo(t)}async function pe(){const e=document.getElementById("matches-list");if(e){e.innerHTML="";try{const o=await(await fetch(`${p}/matches?userId=${t.userId}`)).json();if(!o.success){e.innerHTML="<p class='no-matches'>–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞—Ç—á–µ–π</p>";return}const s=o.data;if(!Array.isArray(s)||s.length===0){e.innerHTML=`
        <div class="no-matches invite-wrapper">
          <p>–ù–µ—Ç –º–∞—Ç—á–µ–π</p>
          <button id="invite-matches" class="invite-button">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>
      `,document.getElementById("invite-matches").addEventListener("click",re);return}s.forEach(r=>{const a=r.avatar||"/img/logo.svg",u=document.createElement("div");u.className="match-card";let w="";r.username&&r.username.trim()!==""?w='<button class="match-write-btn">–ù–ê–ü–ò–°–ê–¢–¨</button>':r.pushSent?w='<button class="match-push-btn" disabled>–í–´ –ü–û–ú–ê–•–ê–õ–ò</button>':w='<button class="match-push-btn">–ü–û–ú–ê–•–ê–¢–¨ üëã</button>',u.innerHTML=`
        <div class="match-user">
          <img class="match-avatar" src="${a}" alt="${r.name}" />
          <span class="match-name">${r.name}${r.age?`, ${r.age}`:""}</span>
        </div>
        <div class="match-actions">
          ${w}
          <button class="match-gift-btn">
            <img src="/img/gift.svg" alt="gift" />
          </button>
        </div>
      `;const m=u.querySelector(".match-push-btn");m&&m.addEventListener("click",async()=>{if(!m.disabled)try{const _=await(await fetch(`${p}/sendPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:t.userId,senderUsername:t.username||t.name,receiverId:r.id})})).json();_.success?(m.textContent="–í–´ –ü–û–ú–ê–•–ê–õ–ò",m.disabled=!0,m.classList.add("match-push-sent")):alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push: "+_.error)}catch(x){console.error("‚ùå –û—à–∏–±–∫–∞ –≤ /api/sendPush:",x),alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push.")}});const b=u.querySelector(".match-write-btn");b&&b.addEventListener("click",()=>{window.open(`https://t.me/${r.username}`,"_blank")});const S=u.querySelector(".match-gift-btn");S&&S.addEventListener("click",()=>{c=r.id,showGiftModal()}),e.appendChild(u),u.querySelector(".match-user").addEventListener("click",()=>{B=r,g("screen-profile")})}),window.renderProInfo&&window.renderProInfo(t)}catch(n){console.error("‚ùå renderMatches:",n),e.innerHTML="<p class='no-matches'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π</p>"}}}function Ue(e){B=e;const n=document.querySelector("#screen-profile .profile-header h2");n&&(n.textContent="–í–∞—à Match");const o=document.getElementById("profileCard"),s=e.photos&&e.photos.length>0?e.photos[0]:e.avatar||"/img/photo.svg";o.style.backgroundImage=`url('${s}')`;const r=document.querySelector("#screen-profile .name-age-container .user-name"),a=document.querySelector("#screen-profile .name-age-container .user-age");r&&(r.textContent=e.name),a&&(e.age?(a.textContent=`${e.age} –ª–µ—Ç`,a.style.display=""):a.style.display="none");const u=document.querySelector("#screen-profile .user-bio");u&&(u.textContent=e.bio||"");const w=document.querySelector("#screen-profile .paginator");W(w,(e.photos||[]).length,0);const m=document.getElementById("edit-profile-button");if(m){m.style.display="none";const x=document.querySelector("#screen-profile .profile-actions");x&&x.remove();const _=document.createElement("div");_.className="profile-actions",_.innerHTML=`
        <button id="candidate-write-btn">–ù–∞–ø–∏—Å–∞—Ç—å</button>
        <button id="candidate-gift-btn">–ü–æ–¥–∞—Ä–æ–∫</button>
      `,m.insertAdjacentElement("afterend",_);let P=document.getElementById("candidate-delete-btn");P&&P.remove(),P=document.createElement("button"),P.id="candidate-delete-btn",P.className="delete-match-btn",P.innerHTML='<img src="/img/unlike.svg" alt="–£–¥–∞–ª–∏—Ç—å" width="24" height="24" /> –£–¥–∞–ª–∏—Ç—å –ú—ç—Ç—á',o.appendChild(P),P.addEventListener("click",async()=>{try{await fetch(`${p}/like`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e.id})}),await fetch(`${p}/dislike`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:t.userId,toUser:e.id})}),await pe(),g("screen-matches"),y()}catch($e){console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –º–∞—Ç—á–µ–π:",$e),window.Telegram.WebApp.showAlert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∏–∑ –ú—ç—Ç—á–µ–π")}})}const b=document.getElementById("candidate-write-btn");b&&(b.onclick=()=>{e.username?window.open(`https://t.me/${e.username}`,"_blank"):window.Telegram.WebApp.showAlert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª username")});const S=document.getElementById("candidate-gift-btn");S&&(S.onclick=()=>{c=e.id,showGiftModal()})}window.showGiftModal=function(){const e=document.querySelector(".gift-backdrop");e&&e.classList.add("open"),document.getElementById("gift-modal").classList.add("open")},window.hideGiftModal=function(){const e=document.querySelector(".gift-backdrop");e&&e.classList.remove("open"),document.getElementById("gift-modal").classList.remove("open")};function ge(e){const n=document.createElement("div");n.textContent=e,Object.assign(n.style,{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"10px 20px",borderRadius:"25px",maxWidth:"100%",zIndex:"2100",pointerEvents:"none",opacity:"1",transition:"opacity 0.5s ease"}),document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),500)},2e3)}window.handleGiftOrder=async function(e){var u,w;event.stopPropagation&&event.stopPropagation();const n=e.closest(".gift-card"),o=n.dataset.giftId,s=((u=n.querySelector(".gift-desc"))==null?void 0:u.textContent.trim())||"",r=((w=n.querySelector(".gift-price"))==null?void 0:w.textContent.trim())||"",a=c;try{const m={userId:t.userId,candidateId:a,giftId:o,message:`üéâ –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –£–≤–µ—Ä–µ–Ω, —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥—ë—Ç –æ—Ç–ª–∏—á–Ω–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ.
–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫: ${s} ‚Äî ${r}`},b={reply_markup:{inline_keyboard:[[{text:"–û–ø–ª–∞—Ç–∏—Ç—å",callback_data:`pay_${o}_${a}`}],[{text:"–û—Ç–º–µ–Ω–∞",callback_data:"cancel_special"}]]}};m.keyboard=b;const x=await(await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).json();x.success||console.error("–û—à–∏–±–∫–∞ specialPush:",x.error)}catch(m){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ specialPush:",m)}hideGiftModal(),ge("–û—Ç–ø—Ä–∞–≤–∏–ª–∏ –ü—É—à")},document.getElementById("gift-modal-close").addEventListener("click",hideGiftModal);const fe=document.getElementById("gift-detail-btn");fe&&fe.addEventListener("click",e=>{e.stopPropagation();const n=[`–ù–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–Ω–∞–∫–æ–º–∏—Ç –≤–∞—Å –Ω–µ —Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω, –Ω–æ –∏ –¥–∞—Ä–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏! üéÅ
–ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞–º–∏ –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞–ø—Ä—è–º—É—é –≤–∞—à–µ–º—É —Å–æ—Å–µ–¥—É: –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∞–¥—Ä–µ—Å ‚Äî –º—ã –≤—Å—ë –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –∏ –¥–æ—Å—Ç–∞–≤–∏–º –≤–∞—à –ø—Ä–µ–∑–µ–Ω—Ç —Ç–æ—á–Ω–æ –≤ —Ä—É–∫–∏.
–ü–µ—Ä–µ–¥ –¥–æ—Å—Ç–∞–≤–∫–æ–π –≤—ã—à–ª–µ–º —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç üì∏, –∞ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–º –≤—Ä—É—á–µ–Ω–∏–µ.
–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫ ‚Äî –≤–µ—Ä–Ω—ë–º –¥–µ–Ω—å–≥–∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.
`].join(`

`),o={reply_markup:{inline_keyboard:[[{text:"–ó–∞–∫–∞–∑–∞—Ç—å",callback_data:"order_now"}],[{text:"–û—Ç–º–µ–Ω–∞",callback_data:"cancel_special"}]]}};fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,message:n,keyboard:o})}).then(s=>s.json()).then(s=>{if(!s.success)throw new Error(s.error);console.log("push sent:",s)}).catch(s=>{console.error("‚ùå specialPush error:",s),alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.")}).finally(()=>{hideGiftModal(),ge("–û—Ç–ø—Ä–∞–≤–∏–ª–∏ –ü—É—à")})});function me(){const e=document.getElementById("profileCard"),n=document.querySelector("#screen-profile .user-info");if(!e||!n){console.error("–≠–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}e.style.transition="transform 0.4s ease",e.style.transformOrigin="top center",e.style.transform="scale(0.5)",n.style.transition="opacity 0.4s ease, transform 0.4s ease",n.style.opacity="0",n.style.transform="translateY(2vh)",setTimeout(()=>{g("screen-profile-edit"),Ie()},400)}const L=document.getElementById("age-toggle-icon"),O=document.getElementById("edit-age-input"),R=document.querySelector(".age-label");L.classList.add("active"),L.style.backgroundImage="url('/img/eye_open.svg')",L.addEventListener("click",()=>{L.classList.toggle("active")?(L.style.backgroundImage="url('/img/eye_open.svg')",O.disabled=!1,O.style.filter="none",R&&(R.style.color=""),t.hideAge=!1):(L.style.backgroundImage="url('/img/eye_close.svg')",O.disabled=!0,O.style.filter="grayscale(100%)",R&&(R.style.color="#999"),t.hideAge=!0)});function T(){const e=document.getElementById("profileCard"),n=document.querySelector("#screen-profile .user-info"),o=document.getElementById("screen-profile-edit");if(!e||!n||!o){console.error("–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."),g("screen-profile");return}e.style.transition="transform 0.4s ease",e.style.transformOrigin="top center",e.style.transform="scale(1)",n.style.transition="opacity 0.4s ease, transform 0.4s ease",n.style.opacity="1",n.style.transform="translateY(0)",setTimeout(()=>{g("screen-profile"),o.style.display="none";const s=document.querySelector("#screen-profile .gradient-card");s&&(s.style.transition="opacity 0.3s ease",s.style.opacity="0",setTimeout(()=>{s.style.opacity="1"},100)),n&&(n.style.transition="opacity 0.3s ease, transform 0.3s ease",n.style.opacity="0",n.style.transform="translateY(20px)",setTimeout(()=>{n.style.opacity="1",n.style.transform="translateY(0)"},100))},400)}window.exitProfileEditMode=T,typeof z<"u"&&z.exports&&(z.exports.exitProfileEditMode=T);const he=document.getElementById("screen-profile");he&&he.querySelectorAll(".edit-button").forEach(e=>{e.style.cursor="pointer",e.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'"),me()})});const ye=document.getElementById("edit-cancel-button"),we=document.getElementById("edit-save-button");ye&&ye.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–û—Ç–º–µ–Ω–∞'"),T()}),we&&we.addEventListener("click",()=>{const e=document.getElementById("edit-bio-input"),n=document.getElementById("edit-age-input"),o=e.value.trim();let s=null;if(!t.hideAge&&(s=parseInt(n.value,10),isNaN(s)||s<1||s>99)){alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç (–æ—Ç 1 –¥–æ 99)");return}const r={userId:t.userId,bio:o,age:s,photos:t.photos};fetch(`${p}/updateProfile`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(a=>a.json()).then(a=>{if(!a.success){alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: "+a.error);return}t.bio=o,t.age=s,T()}).catch(a=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:",a),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è")})});async function Ne(){if(F)return!1;try{const n=await(await fetch(`${p}/users`)).json();if(console.log("üîç checkIfRegistered response:",n),!n.success||!Array.isArray(n.data))return console.warn("‚ùå checkIfRegistered: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞"),!1;const o=n.data.find(s=>String(s.userId)===t.userId);if(console.log("üîç checkIfRegistered: –∏—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",t.userId,"–Ω–∞–π–¥–µ–Ω:",!!o),!o)return!1;t.registered=!0,t.gender=o.gender,t.bio=o.bio,t.age=o.age,t.photos=[],o.photo1&&t.photos.push(o.photo1),o.photo2&&t.photos.push(o.photo2),o.photo3&&t.photos.push(o.photo3),t.photos.length===0&&t.photos.push(o.photoUrl||"/img/logo.svg"),t.photoUrl=t.photos[0],t.username=o.username||t.username,t.likes=JSON.parse(o.likes||"[]"),t.dislikes=JSON.parse(o.dislikes||"[]"),t.badge=o.badge||"",t.needPhoto=Number(o.needPhoto||0);try{const r=await(await fetch(`${p}/goals?userId=${t.userId}`)).json();r.success?t.goals=r.goals||[]:t.goals=[]}catch(s){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–π –≤ checkIfRegistered:",s),t.goals=[]}return console.log("‚úÖ checkIfRegistered: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"),!0}catch(e){return console.error("‚ùå checkIfRegistered:",e),!1}}y();async function H(){if(!F)try{const n=await(await fetch(`${p}/getUser?userId=${t.userId}`)).json();if(!n.success)return;const o=n.data;t.name=o.name||t.name,t.username=o.username||t.username,t.gender=o.gender,t.bio=o.bio||t.bio,t.age=o.age||t.age,t.photos=[],o.photo1&&t.photos.push(o.photo1),o.photo2&&t.photos.push(o.photo2),o.photo3&&t.photos.push(o.photo3),t.photos.length===0&&t.photos.push(o.photoUrl||"/img/logo.svg"),t.photoUrl=t.photos[0],t.likes=JSON.parse(o.likes||"[]"),t.dislikes=JSON.parse(o.dislikes||"[]"),t.badge=o.badge||"",t.needPhoto=Number(o.needPhoto||0),t.is_pro=Number(o.is_pro)===1,t.pro_end=o.pro_end;try{const r=await(await fetch(`${p}/goals?userId=${t.userId}`)).json();r.success?t.goals=r.goals||[]:t.goals=[]}catch(s){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–π:",s),t.goals=[]}window.initProFeatures&&window.initProFeatures(t)}catch(e){console.error("‚ùå loadUserData:",e)}}(async function(){console.log("‚ñ∂ initFlow()..."),console.log("üîç currentUser.userId:",t.userId);const n=await Ne();if(console.log("üîç checkIfRegistered —Ä–µ–∑—É–ª—å—Ç–∞—Ç:",n),!n){console.log("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º welcome"),g("screen-welcome");return}console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ"),await H(),t.gender?(console.log("üîç –ü–æ–ª –∑–∞–¥–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å–≤–∞–π–ø–æ–≤"),g("screen-swipe"),y()):(console.log("üîç –ü–æ–ª –Ω–µ –∑–∞–¥–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞"),g("screen-gender"))})(),y(),setInterval(async()=>{if(t.needPhoto===1)try{await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.userId,message:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ, –¥–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —É–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.",keyboard:G()})})}catch(e){console.error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–ø—É—à–∞ needPhoto:",e)}},5*60*1e3),U=g});function X(c){const f=c.querySelector(".badge-like"),h=c.querySelector(".badge-nope");f&&(f.style.opacity=0),h&&(h.style.opacity=0)}function Fe(c){const f=document.createElement("div");f.className="photo-error-modal",f.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    `;const h=document.createElement("div");h.style.cssText=`
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin: 20px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    `;const i=document.createElement("h3");i.textContent="–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ç–æ",i.style.cssText=`
      margin: 0 0 16px 0;
      color: #333;
      font-size: 18px;
    `;const d=document.createElement("p");d.textContent=c,d.style.cssText=`
      margin: 0 0 24px 0;
      color: #666;
      line-height: 1.5;
    `;const k=document.createElement("button");k.textContent="–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ",k.style.cssText=`
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 12px;
    `,k.onclick=()=>{document.body.removeChild(f),showTelegramModal()};const I=document.createElement("button");I.textContent="–û—Ç–º–µ–Ω–∞",I.style.cssText=`
      background: #F2F2F7;
      color: #007AFF;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
    `,I.onclick=()=>{document.body.removeChild(f)},h.appendChild(i),h.appendChild(d),h.appendChild(k),h.appendChild(I),f.appendChild(h),document.body.appendChild(f)}});export default We();
