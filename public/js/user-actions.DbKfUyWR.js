async function l(){const o=window.currentUser;if(!o||!o.userId){console.error("‚ùå [loadUserData] currentUser –Ω–µ –Ω–∞–π–¥–µ–Ω:",o);return}console.log("üì• [loadUserData] –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è userId:",o.userId);try{console.log("üì• [loadUserData] –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º /api/getUser");const s=await(await fetch(`${o.API_URL||window.API_URL}/getUser?userId=${o.userId}`)).json();if(console.log("üì• [loadUserData] –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",s),!s||!s.success){console.log("üì• [loadUserData] –ù–µ—É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º");return}const e=s.data;console.log("üì• [loadUserData] –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",e),o.name=e.name||o.name,o.username=e.username||o.username,o.gender=e.gender,o.bio=e.bio||o.bio,o.age=e.age||o.age,o.photos=[],e.photo1&&o.photos.push(e.photo1),e.photo2&&o.photos.push(e.photo2),e.photo3&&o.photos.push(e.photo3),console.log("üì• [loadUserData] –ü–æ—Å–ª–µ photo1/2/3:",o.photos),o.photos.length===0&&(o.photos.push(e.photoUrl||"/img/logo.svg"),console.log("üì• [loadUserData] –ü–æ—Å–ª–µ photoUrl fallback:",o.photos)),o.photos.length===0&&(e.photoUrl&&o.photos.push(e.photoUrl),e.photoUrl2&&o.photos.push(e.photoUrl2),e.photoUrl3&&o.photos.push(e.photoUrl3),console.log("üì• [loadUserData] –ü–æ—Å–ª–µ photoUrl2/3:",o.photos)),o.photoUrl=o.photos[0],o.likes=JSON.parse(e.likes||"[]"),o.dislikes=JSON.parse(e.dislikes||"[]"),o.badge=e.badge||"",o.goals=JSON.parse(e.goals||"[]"),o.goals=Array.isArray(s.data.goals)?s.data.goals:o.goals,window.pro&&window.pro.updateProStatus&&window.pro.updateProStatus(o,Number(s.data.is_pro)===1,s.data.pro_end),o.superLikesCount=Number(s.data.super_likes_count)||0,o.needPhoto=Number(e.needPhoto||0),o.is_pro&&(console.log("‚ñ∂ Allocating 3 SuperLikes for PRO user"),o.superLikesCount=3);const r=localStorage.getItem("superLikesCount");r!==null&&(o.superLikesCount=parseInt(r,10)),console.log("üì• [loadUserData] currentUser –æ–±–Ω–æ–≤–ª—ë–Ω:",o)}catch(t){console.error("‚ùå [loadUserData] –û—à–∏–±–∫–∞:",t)}}function d(){const o=this,t=o.classList&&o.classList.contains("add-photo");if(t)o.innerHTML='<img src="/img/preloader.svg" class="preloader-btn" alt="–ó–∞–≥—Ä—É–∑–∫–∞..." />',o.classList.add("loading");else{o.disabled=!0;const e=o.textContent;o.dataset.origText=e,o.innerHTML=`<img src="/img/preloader.svg" class="preloader-btn" alt="–ó–∞–≥—Ä—É–∑–∫–∞..." /> ${e}`}const s=document.createElement("input");s.type="file",s.accept="image/*",s.style.display="none",document.body.appendChild(s),s.addEventListener("change",async function(e){const r=e.target.files[0];if(!r){document.body.removeChild(s),t?(o.innerHTML="",o.classList.remove("loading")):(o.disabled=!1,o.textContent=o.dataset.origText||"–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ");return}const n=new FormData;n.append("file",r),n.append("userId",window.currentUser.userId),window.tg&&window.tg.showProgressBar&&window.tg.showProgressBar();try{const a=await(await fetch(`${window.API_URL}/webUploadPhoto`,{method:"POST",body:n})).json();a.success&&a.url?(window.currentUser.photos=window.currentUser.photos||[],window.currentUser.photos.push(a.url),window.loadUserData&&await window.loadUserData(),t&&window.initProfileEditScreen?(o.innerHTML="",o.classList.remove("loading"),window.initProfileEditScreen()):!t&&window.updateProfileScreen&&(o.disabled=!1,o.textContent="–§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ",window.updateProfileScreen())):(alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ: "+(a.error||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞")),t?(o.innerHTML="",o.classList.remove("loading")):(o.disabled=!1,o.textContent=o.dataset.origText||"–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ"))}catch(i){alert("–û—à–∏–±–∫–∞ JS: "+i),t?(o.innerHTML="",o.classList.remove("loading")):(o.disabled=!1,o.textContent=o.dataset.origText||"–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ")}finally{window.tg&&window.tg.hideProgressBar&&window.tg.hideProgressBar(),document.body.removeChild(s)}}),s.click()}const p={loadUserData:l,handlePhotoAddition:d};export{p as default,d as handlePhotoAddition,l as loadUserData};
