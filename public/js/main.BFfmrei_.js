var je=(c,f)=>()=>(f||c((f={exports:{}}).exports,f),f.exports);import{i as ve,_ as De}from"./card.D_SZHx2c.js";import{r as Oe,i as Ne}from"./pro.LCHVUHva.js";import{s as Je,i as He}from"./pro-modal.Deig-JMx.js";import"./utils.DE1O8Krf.js";import"./api.u-GyJUGh.js";import"./gift.IGWJdFdP.js";var We=je((Ze,W)=>{window.initProfileEditScreen=ve;window.renderProInfo=Oe;window.initProFeatures=Ne;window.showProModal=Je;window.initProModalHandlers=He;let l=null;window.Telegram&&window.Telegram.WebApp?(l=window.Telegram.WebApp,l.expand(),l.setHeaderColor("#ffffff"),l.setBackgroundColor("#f4f4f4"),console.log("‚úÖ Telegram.WebApp –ø–æ–¥–∫–ª—é—á–µ–Ω:",l),console.log("‚ÑπÔ∏è tg.initData:",l.initData),console.log("‚ÑπÔ∏è tg.initDataUnsafe:",l.initDataUnsafe)):console.warn("‚ö† Telegram.WebApp –Ω–µ –Ω–∞–π–¥–µ–Ω (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π/–ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º?)");const p=window.API_BASE_URL||"https://sta-black-dim.waw.amverum.cloud/api",H=window.location.hostname==="localhost",Re=window.WEB_APP_URL||typeof window<"u"&&window.WEB_APP_URL?window.WEB_APP_URL:"https://sta-black-dim.waw.amverum.cloud";let R=null,n={userId:"UserID",name:"Username",username:"",photoUrl:"/img/logo.svg",gender:"",bio:"",age:0,photos:[],registered:!1,likes:[],dislikes:[],badge:"",needPhoto:0,hideAge:!1,API_URL:p};console.log("‚ÑπÔ∏è –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π currentUser:",n);console.log("üîç tg –æ–±—ä–µ–∫—Ç:",l);console.log("üîç tg.initDataUnsafe:",l==null?void 0:l.initDataUnsafe);var we;console.log("üîç tg.initDataUnsafe.user:",(we=l==null?void 0:l.initDataUnsafe)==null?void 0:we.user);var ke;if(l&&l.initDataUnsafe&&l.initDataUnsafe.user){const c=l.initDataUnsafe.user;console.log("‚ÑπÔ∏è tg.initDataUnsafe.user =",c),console.log("üîç u.id:",c.id,"—Ç–∏–ø:",typeof c.id),console.log("üîç u.first_name:",c.first_name,"—Ç–∏–ø:",typeof c.first_name),console.log("üîç u.username:",c.username,"—Ç–∏–ø:",typeof c.username),console.log("üîç u.photo_url:",c.photo_url,"—Ç–∏–ø:",typeof c.photo_url),n.userId=String(c.id||"UserID"),n.name=c.first_name||"Username",n.username=c.username||"",c.photo_url&&c.photo_url.startsWith("http")&&(n.photoUrl=c.photo_url),console.log("‚úÖ currentUser –æ–±–Ω–æ–≤–ª—ë–Ω –∏–∑ tg.initDataUnsafe:",n)}else console.warn("‚ö† –ù–µ –ø–æ–ª—É—á–∏–ª–∏ initDataUnsafe.user ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É"),console.log("üîç tg:",!!l),console.log("üîç tg.initDataUnsafe:",!!(l!=null&&l.initDataUnsafe)),console.log("üîç tg.initDataUnsafe.user:",!!((ke=l==null?void 0:l.initDataUnsafe)!=null&&ke.user));function F(c,f,h){if(c.innerHTML="",f<2){c.style.display="none";return}c.style.display="flex";for(let r=0;r<f;r++){const d=document.createElement("div");d.className=r===h?"pag_active":"pag",c.appendChild(d)}}document.addEventListener("DOMContentLoaded",()=>{console.log("‚ñ∂ DOMContentLoaded: init main.js..."),R=m;let c=null;const f=document.getElementById("gift-modal");f&&f.classList.remove("open");const h=document.querySelector(".gift-backdrop");h&&h.classList.remove("open");const r=document.getElementById("singleCard");let d=[],k=0,v=0,$=!1,B=null;window.showScreen=m,window.currentUser=n,window.API_URL=p,window.showCandidate=S,De(()=>import("./chunks/user-actions.DbKfUyWR.js"),[]).then(e=>{window.handlePhotoAddition=e.handlePhotoAddition,console.log("‚úÖ handlePhotoAddition –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å")}).catch(e=>{console.warn("‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å handlePhotoAddition:",e)});function Ie(e,t){let o=(t.photos||[]).filter(s=>s&&s.trim()!=="");o.length===0&&(o=["/img/photo.svg"]),e.style.backgroundImage=`url('${o[0]}')`,e.dataset.photos=JSON.stringify(o),v=0,e.dataset.userId=t.id,e.innerHTML=`
    <div class="gradient-card"></div>
    <div class="user-info">
      ${t.badge?`<div class="badge-wrapper"><img src="${window.WEB_APP_URL||"https://sta-black-dim.waw.amverum.cloud"}${t.badge}" class="badge-image"></div>`:""}
      <div class="name-age-container">
        <span class="user-name">${t.name}</span>
        ${!n.hideAge&&t.age?`<span class="user-age">${t.age} –ª–µ—Ç</span>`:""}
      </div>
      <p class="user-bio">${t.bio||""}</p>
      <div class="paginator"></div>
    </div>
    <div class="card-badge badge-like">üòç</div>
    <div class="card-badge badge-nope">üö´</div>
    <div class="card-badge badge-match"></div>
  `,F(e.querySelector(".paginator"),o.length,0)}const X=document.getElementById("join-button");X&&X.addEventListener("click",()=>{let e={};l&&l.initDataUnsafe&&l.initDataUnsafe.user&&(e=l.initDataUnsafe.user);const t={userId:String(e.id||"UserID"),name:e.first_name||"Username",username:e.username||"",photoUrl:e.photo_url&&e.photo_url.startsWith("http")?e.photo_url:"/img/logo.svg",gender:"",bio:""};console.log("–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏:",t),fetch(`${p}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(o=>o.json()).then(o=>{if(!o.success)throw new Error(o.error||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞");console.log("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ:",o),n.registered=!0,m("screen-gender"),l&&l.sendData&&l.sendData(JSON.stringify({action:"register",userId:t.userId}));const s=`https://t.me/SeligerTinderApp_bot?start=${t.userId}`;l&&l.openLink?l.openLink(s):window.open(s,"_blank")}).catch(o=>{console.error("‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:",o),alert("–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: "+o.message)})});const C=document.getElementById("maleBtn"),T=document.getElementById("femaleBtn");function K(e){C&&T&&(e==="male"?(C.classList.add("active"),T.classList.remove("active")):e==="female"&&(T.classList.add("active"),C.classList.remove("active")),n.gender=e,console.log("–ü–æ–ª –≤—ã–±—Ä–∞–Ω: "+n.gender))}const V=document.getElementById("continue-button");V&&V.addEventListener("click",async()=>{if(console.log("–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–ü–†–û–î–û–õ–ñ–ò–¢–¨', currentUser.gender = '"+n.gender+"'"),!n.gender||n.gender!=="male"&&n.gender!=="female"){alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –ø–æ–ª, –Ω–∞–∂–∞–≤ –æ–¥–Ω—É –∏–∑ –∫–Ω–æ–ø–æ–∫ '–ú–£–ñ–ß–ò–ù–ê' –∏–ª–∏ '–ñ–ï–ù–©–ò–ù–ê'.");return}if(!H)try{const t=await(await fetch(`${p}/updateGender`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.userId,gender:n.gender,photoUrl:n.photoUrl})})).json();if(!t.success){if(t.error&&(t.error.includes("–º–µ–º")||t.error.includes("–ø–æ–ª")||t.error.includes("–ª–∏—Ü–æ"))){Fe(t.error);return}alert("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞: "+t.error);return}await J()}catch(e){console.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞:",e),alert("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–∞.");return}m("screen-swipe")}),C&&C.addEventListener("click",()=>K("male")),T&&T.addEventListener("click",()=>K("female"));const Q=document.getElementById("matches-button");Q&&Q.addEventListener("click",()=>{y(),m("screen-matches")});const Z=document.getElementById("back-button");Z&&Z.addEventListener("click",()=>{console.log("‚ñ∂ Back –∏–∑ Matches -> –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ screen-swipe"),m("screen-swipe")});const ee=document.getElementById("profile-back-button");ee&&ee.addEventListener("click",()=>{B?(B=null,m("screen-matches")):(console.log("‚ñ∂ Back –∏–∑ Profile -> –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ screen-swipe"),m("screen-swipe"))});const M=document.getElementById("profile-edit-back-button");M&&(M.style.padding="24px",M.style.margin="-24px",M.addEventListener("click",()=>{console.log("‚ñ∂ Back –∏–∑ Profile Edit -> –≤—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"),U()}));function z(){return{reply_markup:{inline_keyboard:[[{text:"‚ú®–û—Ç–∫—Ä—ã—Ç—å Seliger Tinder‚ú®",web_app:{url:Re}}],[{text:"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ",callback_data:"upload_photo"},{text:"–î–æ–±–∞–≤–∏—Ç—å –æ —Å–µ–±–µ",callback_data:"add_bio"}],[{text:"–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç",callback_data:"update_age"},{text:"–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å",callback_data:"delete_user"}],[{text:"–ó–∞–ø—Ä–æ—Å–∏—Ç—å –±–µ–π–¥–∂",callback_data:"request_badge"}],[{text:"–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è/–û—à–∏–±–∫–∞/–ü—Ä–æ–±–ª–µ–º–∞",callback_data:"dev_message"}]]}}}const A=document.getElementById("tg-modal"),te=document.getElementById("tg-modal-ok"),ne=document.getElementById("tg-modal-cancel");function Se(){A&&(A.style.display="flex")}const oe=document.getElementById("add-photo-btn");oe&&oe.addEventListener("click",Se);function se(){A&&(A.style.display="none")}te&&te.addEventListener("click",async()=>{console.log("üåü specialPush triggered, payload:",{userId:n.userId,message:`–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1‚Äì3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º. üì∏‚ú®
–≠—Ç–æ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –º–∏–Ω—É—Ç—É!
`,keyboard:z()});try{const t=await(await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.userId,message:`–ß—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1‚Äì3 –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º. üì∏‚ú®
–≠—Ç–æ –∑–∞–π–º–µ—Ç –≤—Å–µ–≥–æ –º–∏–Ω—É—Ç—É!
`,keyboard:z()})})).json();console.log("‚úÖ specialPush response:",t),t.success||console.error("Push error:",t.error)}catch(e){console.error("‚ùå –û—à–∏–±–∫–∞ –≤ –∑–∞–ø—Ä–æ—Å–µ /api/specialPush:",e)}se()}),ne&&ne.addEventListener("click",se);function S(){if(n.needPhoto===1){console.log('[showCandidate] needPhoto=1, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ"'),r.style.backgroundImage="none",r.style.backgroundColor="#fff",r.innerHTML=`
        <div class="no-users invite-wrapper">
          <h3>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ 1-3 —Ñ–æ—Ç–æ —Å –ª–∏—Ü–æ–º, —á—Ç–æ–±—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∞–Ω–∫–µ—Ç—ã.</h3>
          <button id="add-photo-swipe-btn" class="invite-button">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</button>
        </div>
      `,r.style.boxShadow="none",document.querySelectorAll(".back-cnd-btn, .superlike_d, .like_d, .dislike_d").forEach(t=>t.style.display="none");const e=document.getElementById("add-photo-swipe-btn");if(e){const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",function(){window.handlePhotoAddition?window.handlePhotoAddition.call(t):console.warn("handlePhotoAddition –Ω–µ –Ω–∞–π–¥–µ–Ω")}),console.log("[showCandidate] –ö–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω–∞, –Ω–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ handlePhotoAddition")}return}if(!d||d.length===0||k>=d.length){r.style.backgroundImage="none",r.style.backgroundColor="#fff",r.innerHTML=`
        <div class="no-users invite-wrapper">
          <h3>–ù–µ—Ç –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
          <button id="invite-button" class="invite-button">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>
      `,r.style.boxShadow="none",document.querySelectorAll(".like_d, .dislike_d").forEach(e=>e.style.display="none"),document.getElementById("invite-button").addEventListener("click",re);return}Ie(r,d[k]),r.classList.remove("show-match","returning"),document.querySelectorAll(".like_d, .dislike_d").forEach(e=>e.style.display=n.needPhoto?"none":"flex")}function Ee(){$=!0,r.style.transition="transform 0.5s ease",r.style.transform="translate(1000px, 0) rotate(45deg)",setTimeout(()=>{r.style.transition="transform 0.3s ease",r.style.transform="none",Y(r);const e=r.querySelector(".badge-match");e&&(e.innerHTML="‚ù§Ô∏è‚Äçüî•",e.style.opacity="",e.style.transform="",e.classList.add("match-animation"),e.addEventListener("animationend",()=>{e.classList.remove("match-animation")},{once:!0})),"vibrate"in navigator&&navigator.vibrate([50,30,80,30,110,30,150]);const t=document.querySelector(".like_d"),o=document.querySelector(".dislike_d"),s=d.find(i=>String(i.id)===r.dataset.userId);t&&(t.style.display="flex",t.innerHTML='<img class="next" src="/img/next.svg" alt="next" />',t.onclick=()=>{D()}),o&&(o.style.display="flex",s&&s.username?(o.style.backgroundColor="#55a6ff",o.innerHTML='<img class="chat" src="/img/chat.svg" alt="chat" />',o.onclick=()=>window.open(`https://t.me/${s.username}`,"_blank")):(o.innerHTML="üëã",o.style.backgroundColor="#ff5e5e",o.style.fontSize="36px",o.onclick=async()=>{const i=o;try{(await(await fetch(`${p}/sendPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:n.userId,senderUsername:n.username||n.name,receiverId:s.id})})).json()).success&&(i.textContent="üëã",i.disabled=!0,i.style.backgroundColor="#ccc")}catch(a){console.error("‚ùå /api/sendPush –æ—à–∏–±–∫–∞:",a)}})),y()},500)}function re(){const e="–ü—Ä–∏–≤–µ—Ç! –ù–∞—à—ë–ª —É–¥–æ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–Ω–∞–∫–æ–º—Å—Ç–≤ –º–µ–∂–¥—É —Å–æ—Å–µ–¥—è–º–∏ –Ω–∞—à–µ–≥–æ –ñ–ö.: https://t.me/SeligerTinderApp_bot/sta";navigator.share?navigator.share({text:e}):navigator.clipboard.writeText(e).then(()=>alert("–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞")).catch(()=>alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç"))}let G=!1,ie=0,ae=0,E=0,q=0;const xe=200,j=64,Pe=128,Be=100;r&&(r.addEventListener("pointerdown",e=>{k>=d.length||(G=!0,ie=e.clientX,ae=e.clientY,r.setPointerCapture(e.pointerId),r.style.transition="none")}),r.addEventListener("pointermove",e=>{if(!G)return;E=e.clientX-ie,q=e.clientY-ae;const t=E/200*20;r.style.transform=`translate(${E}px, ${q}px) rotate(${t}deg)`,r.style.boxShadow="0 8px 24px rgba(0,0,0,0.3)";const o=r.querySelector(".badge-like"),s=r.querySelector(".badge-nope");let i=Math.min(Math.abs(E)/xe,1),a=j+(Pe-j)*i;E>0?(o&&(o.style.opacity=i,o.style.fontSize=a+"px"),s&&(s.style.opacity=0,s.style.fontSize=j+"px")):(s&&(s.style.opacity=i,s.style.fontSize=a+"px"),o&&(o.style.opacity=0,o.style.fontSize=j+"px"))}),r.addEventListener("pointerup",e=>{G=!1,r.releasePointerCapture(e.pointerId);const t=Math.abs(E),o=Math.abs(q);t<10&&o<10?_e():t>Be?(E>0?"right":"left")==="right"?ue():de():(r.style.transition="transform 0.3s ease",r.style.transform="none",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.2)",Y(r),E=0,q=0)}));function _e(){const e=r.dataset.photos?JSON.parse(r.dataset.photos):[];if(e.length<2)return;v=(v+1)%e.length,r.style.backgroundImage=`url('${e[v]}')`;const t=r.querySelector(".paginator");t&&F(t,e.length,v)}const le=document.querySelector(".like_d"),ce=document.querySelector(".dislike_d");le&&le.addEventListener("click",()=>{!d||d.length===0||k>=d.length?S():ue()}),ce&&ce.addEventListener("click",()=>{!d||d.length===0||k>=d.length?S():de()});async function de(){const e=r.dataset.userId,t=d.findIndex(o=>String(o.id)===String(e));if(t>=0)try{await fetch(`${p}/dislike`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:n.userId,toUser:e})})}catch(o){console.error("‚ùå /api/dislike –æ—à–∏–±–∫–∞:",o)}r.style.transition="transform 0.5s ease",r.style.transform="translate(-1000px, 0) rotate(-45deg)",setTimeout(()=>{t>=0&&d.splice(t,1),D(),y()},500)}async function y(){const e=document.getElementById("matches-count");if(e){if(H){e.textContent="2",e.style.display="inline-block";return}try{const t=`${p}/matches?userId=${n.userId}`,s=await(await fetch(t)).json();if(!s.success||!Array.isArray(s.data)){e.style.display="none";return}const i=s.data.length;e.textContent=i>0?i:"",e.style.display=i>0?"inline-block":"none"}catch(t){console.error("‚ùå updateMatchesCount:",t)}}}async function Le(){if(!n.gender)return;if(n.needPhoto===1){d=[],S(),y();return}const e=n.gender==="male"?"female":"male",t=`${p}/candidates?oppositeGender=${e}&userId=${n.userId}`;try{const s=await(await fetch(t)).json();if(s.success&&Array.isArray(s.data)){const i=new Set(n.likes),a=new Set(n.dislikes);d=s.data.filter(u=>!i.has(u.id)&&!a.has(u.id)&&Number(u.needPhoto||0)===0),k=0}S(),y()}catch(o){console.error("‚ùå loadCandidates:",o),d=[],S(),y()}}async function ue(){if($){D();return}const e=r.dataset.userId,t=d.findIndex(o=>String(o.id)===String(e));if(!(t<0))try{const s=await(await fetch(`${p}/like`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:n.userId,toUser:e})})).json();s.success&&s.mutual?Ee():(r.style.transition="transform 0.5s ease",r.style.transform="translate(1000px, 0) rotate(45deg)",setTimeout(()=>{d.splice(t,1),D(),y()},500))}catch(o){console.error("‚ùå /api/like –æ—à–∏–±–∫–∞:",o)}}function D(){if($){const o=d.findIndex(s=>String(s.id)===r.dataset.userId);o>=0&&d.splice(o,1)}$=!1,r.style.transition="none",r.style.transform="none",Y(r);const e=document.querySelector(".like_d"),t=document.querySelector(".dislike_d");e&&(e.innerHTML='<img class="like" src="/img/like.svg" alt="like" />',e.onclick=null,e.style.backgroundColor="",e.style.fontSize=""),t&&(t.innerHTML='<img class="dislike" src="/img/dislike.svg" alt="dislike" />',t.onclick=null,t.style.backgroundColor="",t.style.fontSize=""),document.querySelectorAll(".like_d, .dislike_d").forEach(o=>o.style.display="flex"),S()}function m(e){if(e==="screen-profile"&&B){document.querySelectorAll(".screen").forEach(o=>o.style.display="none"),document.getElementById("screen-profile").style.display="block",Me(B);return}document.querySelectorAll(".screen").forEach(o=>o.style.display="none");const t=document.getElementById(e);if(!t){console.error(`‚ùå –ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞ —Å id="${e}"`);return}if(t.style.display="block",console.log(`‚ñ∂ –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω: ${e}`),e==="screen-welcome"&&Ce(),e==="screen-gender"&&Te(),e==="screen-swipe"){Ue(),y();const o=document.querySelector("#screen-swipe .ava-frame");o&&(o.style.cursor="pointer",o.addEventListener("click",()=>{B=null,m("screen-profile")})),J().then(()=>{n.needPhoto===1?(d=[],S(),y()):Le()}).catch(s=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–≤–∞–π–ø–µ:",s))}if(e==="screen-matches"&&(y(),pe()),e==="screen-profile"){const o=document.querySelector("#screen-profile .profile-header h2");o&&(o.textContent="–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å");const s=document.getElementById("edit-profile-button");s&&(s.style.display="");const i=document.querySelector("#screen-profile .profile-actions");i&&i.remove();const a=document.getElementById("candidate-delete-btn");a&&a.remove(),J().then(()=>{$e();const u=document.getElementById("edit-profile-button");u&&(u.style.cursor="pointer",u.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' –Ω–∞ —ç–∫—Ä–∞–Ω–µ –ø—Ä–æ—Ñ–∏–ª—è"),me()}))}).catch(u=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",u))}}function Ce(){const e=document.querySelector("#screen-welcome .user-name");e&&(e.textContent=n.name)}function Te(){const e=document.querySelector("#screen-gender .user-avatar-small"),t=document.querySelector("#screen-gender .user-id h3");e&&(e.src=n.photoUrl),t&&(t.textContent=n.name)}function Ue(){const e=document.querySelector("#screen-swipe .avatar_small_2"),t=document.querySelector("#screen-swipe .user-id2");e&&(e.src=n.photoUrl),t&&(t.innerHTML=`<span class="user-link">${n.name}</span>`)}function $e(){const e=document.getElementById("profileCard"),t=document.querySelector("#screen-profile .user-info"),o=document.querySelector("#screen-profile .user-bio"),s=document.querySelector("#screen-profile .paginator");if(e&&t){const b=t.querySelector(".badge-wrapper");b&&b.remove();const g=t.querySelector(".name-age-container .user-name");g&&(g.textContent=n.name);const w=t.querySelector(".name-age-container .user-age");if(w&&(!n.hideAge&&n.age?(w.textContent=`${n.age} –ª–µ—Ç`,w.style.display=""):w.style.display="none"),n.badge&&n.badge.trim()!==""){const I=document.createElement("div");I.className="badge-wrapper",I.innerHTML=`<img src="https://sta-black-dim.waw.amverum.cloud${n.badge}" alt="Badge" class="badge-image">`,t.prepend(I)}}o&&(o.textContent=n.bio);function i(b,g){s&&F(s,b,g)}let a=n.photos||[],u=0;e&&(e.style.backgroundImage=`url('${a.length>0?a[0]:"/img/photo.svg"}')`,e.onclick=()=>{a.length<2||(u=(u+1)%a.length,e.style.backgroundImage=`url('${a[u]}')`,i(a.length,u))}),i(a.length,0),window.renderProInfo&&window.renderProInfo(n)}async function pe(){const e=document.getElementById("matches-list");if(e){e.innerHTML="";try{const o=await(await fetch(`${p}/matches?userId=${n.userId}`)).json();if(!o.success){e.innerHTML="<p class='no-matches'>–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞—Ç—á–µ–π</p>";return}const s=o.data;if(!Array.isArray(s)||s.length===0){e.innerHTML=`
        <div class="no-matches invite-wrapper">
          <p>–ù–µ—Ç –º–∞—Ç—á–µ–π</p>
          <button id="invite-matches" class="invite-button">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
        </div>
      `,document.getElementById("invite-matches").addEventListener("click",re);return}s.forEach(i=>{const a=i.avatar||"/img/logo.svg",u=document.createElement("div");u.className="match-card";let b="";i.username&&i.username.trim()!==""?b='<button class="match-write-btn">–ù–ê–ü–ò–°–ê–¢–¨</button>':i.pushSent?b='<button class="match-push-btn" disabled>–í–´ –ü–û–ú–ê–•–ê–õ–ò</button>':b='<button class="match-push-btn">–ü–û–ú–ê–•–ê–¢–¨ üëã</button>',u.innerHTML=`
        <div class="match-user">
          <img class="match-avatar" src="${a}" alt="${i.name}" />
          <span class="match-name">${i.name}${i.age?`, ${i.age}`:""}</span>
        </div>
        <div class="match-actions">
          ${b}
          <button class="match-gift-btn">
            <img src="/img/gift.svg" alt="gift" />
          </button>
        </div>
      `;const g=u.querySelector(".match-push-btn");g&&g.addEventListener("click",async()=>{if(!g.disabled)try{const L=await(await fetch(`${p}/sendPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:n.userId,senderUsername:n.username||n.name,receiverId:i.id})})).json();L.success?(g.textContent="–í–´ –ü–û–ú–ê–•–ê–õ–ò",g.disabled=!0,g.classList.add("match-push-sent")):alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push: "+L.error)}catch(x){console.error("‚ùå –û—à–∏–±–∫–∞ –≤ /api/sendPush:",x),alert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ push.")}});const w=u.querySelector(".match-write-btn");w&&w.addEventListener("click",()=>{window.open(`https://t.me/${i.username}`,"_blank")});const I=u.querySelector(".match-gift-btn");I&&I.addEventListener("click",()=>{c=i.id,showGiftModal()}),e.appendChild(u),u.querySelector(".match-user").addEventListener("click",()=>{B=i,m("screen-profile")})}),window.renderProInfo&&window.renderProInfo(n)}catch(t){console.error("‚ùå renderMatches:",t),e.innerHTML="<p class='no-matches'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—á–µ–π</p>"}}}function Me(e){B=e;const t=document.querySelector("#screen-profile .profile-header h2");t&&(t.textContent="–í–∞—à Match");const o=document.getElementById("profileCard"),s=e.photos&&e.photos.length>0?e.photos[0]:e.avatar||"/img/photo.svg";o.style.backgroundImage=`url('${s}')`;const i=document.querySelector("#screen-profile .name-age-container .user-name"),a=document.querySelector("#screen-profile .name-age-container .user-age");i&&(i.textContent=e.name),a&&(e.age?(a.textContent=`${e.age} –ª–µ—Ç`,a.style.display=""):a.style.display="none");const u=document.querySelector("#screen-profile .user-bio");u&&(u.textContent=e.bio||"");const b=document.querySelector("#screen-profile .paginator");F(b,(e.photos||[]).length,0);const g=document.getElementById("edit-profile-button");if(g){g.style.display="none";const x=document.querySelector("#screen-profile .profile-actions");x&&x.remove();const L=document.createElement("div");L.className="profile-actions",L.innerHTML=`
        <button id="candidate-write-btn">–ù–∞–ø–∏—Å–∞—Ç—å</button>
        <button id="candidate-gift-btn">–ü–æ–¥–∞—Ä–æ–∫</button>
      `,g.insertAdjacentElement("afterend",L);let P=document.getElementById("candidate-delete-btn");P&&P.remove(),P=document.createElement("button"),P.id="candidate-delete-btn",P.className="delete-match-btn",P.innerHTML='<img src="/img/unlike.svg" alt="–£–¥–∞–ª–∏—Ç—å" width="24" height="24" /> –£–¥–∞–ª–∏—Ç—å –ú—ç—Ç—á',o.appendChild(P),P.addEventListener("click",async()=>{try{await fetch(`${p}/like`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:n.userId,toUser:e.id})}),await fetch(`${p}/dislike`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fromUser:n.userId,toUser:e.id})}),await pe(),m("screen-matches"),y()}catch(qe){console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –º–∞—Ç—á–µ–π:",qe),window.Telegram.WebApp.showAlert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∏–∑ –ú—ç—Ç—á–µ–π")}})}const w=document.getElementById("candidate-write-btn");w&&(w.onclick=()=>{e.username?window.open(`https://t.me/${e.username}`,"_blank"):window.Telegram.WebApp.showAlert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∫–∞–∑–∞–ª username")});const I=document.getElementById("candidate-gift-btn");I&&(I.onclick=()=>{c=e.id,showGiftModal()})}window.showGiftModal=function(){const e=document.querySelector(".gift-backdrop");e&&e.classList.add("open"),document.getElementById("gift-modal").classList.add("open")},window.hideGiftModal=function(){const e=document.querySelector(".gift-backdrop");e&&e.classList.remove("open"),document.getElementById("gift-modal").classList.remove("open")};function fe(e){const t=document.createElement("div");t.textContent=e,Object.assign(t.style,{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"10px 20px",borderRadius:"25px",maxWidth:"100%",zIndex:"2100",pointerEvents:"none",opacity:"1",transition:"opacity 0.5s ease"}),document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),500)},2e3)}window.handleGiftOrder=async function(e){var u,b;event.stopPropagation&&event.stopPropagation();const t=e.closest(".gift-card"),o=t.dataset.giftId,s=((u=t.querySelector(".gift-desc"))==null?void 0:u.textContent.trim())||"",i=((b=t.querySelector(".gift-price"))==null?void 0:b.textContent.trim())||"",a=c;try{const g={userId:n.userId,candidateId:a,giftId:o,message:`üéâ –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –£–≤–µ—Ä–µ–Ω, —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥—ë—Ç –æ—Ç–ª–∏—á–Ω–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ.
–í—ã –≤—ã–±—Ä–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫: ${s} ‚Äî ${i}`},w={reply_markup:{inline_keyboard:[[{text:"–û–ø–ª–∞—Ç–∏—Ç—å",callback_data:`pay_${o}_${a}`}],[{text:"–û—Ç–º–µ–Ω–∞",callback_data:"cancel_special"}]]}};g.keyboard=w;const x=await(await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)})).json();x.success||console.error("–û—à–∏–±–∫–∞ specialPush:",x.error)}catch(g){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ specialPush:",g)}hideGiftModal(),fe("–û—Ç–ø—Ä–∞–≤–∏–ª–∏ –ü—É—à")},document.getElementById("gift-modal-close").addEventListener("click",hideGiftModal);const ge=document.getElementById("gift-detail-btn");ge&&ge.addEventListener("click",e=>{e.stopPropagation();const t=[`–ù–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∑–Ω–∞–∫–æ–º–∏—Ç –≤–∞—Å –Ω–µ —Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω, –Ω–æ –∏ –¥–∞—Ä–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏! üéÅ
–ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –≤–∞–º–∏ –ø–æ–¥–∞—Ä–æ–∫ –Ω–∞–ø—Ä—è–º—É—é –≤–∞—à–µ–º—É —Å–æ—Å–µ–¥—É: –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∞–¥—Ä–µ—Å ‚Äî –º—ã –≤—Å—ë –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º –∏ –¥–æ—Å—Ç–∞–≤–∏–º –≤–∞—à –ø—Ä–µ–∑–µ–Ω—Ç —Ç–æ—á–Ω–æ –≤ —Ä—É–∫–∏.
–ü–µ—Ä–µ–¥ –¥–æ—Å—Ç–∞–≤–∫–æ–π –≤—ã—à–ª–µ–º —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç üì∏, –∞ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–º –≤—Ä—É—á–µ–Ω–∏–µ.
–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫ ‚Äî –≤–µ—Ä–Ω—ë–º –¥–µ–Ω—å–≥–∏ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.
`].join(`

`),o={reply_markup:{inline_keyboard:[[{text:"–ó–∞–∫–∞–∑–∞—Ç—å",callback_data:"order_now"}],[{text:"–û—Ç–º–µ–Ω–∞",callback_data:"cancel_special"}]]}};fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.userId,message:t,keyboard:o})}).then(s=>s.json()).then(s=>{if(!s.success)throw new Error(s.error);console.log("push sent:",s)}).catch(s=>{console.error("‚ùå specialPush error:",s),alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.")}).finally(()=>{hideGiftModal(),fe("–û—Ç–ø—Ä–∞–≤–∏–ª–∏ –ü—É—à")})});function me(){const e=document.getElementById("profileCard"),t=document.querySelector("#screen-profile .user-info");if(!e||!t){console.error("–≠–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã");return}e.style.transition="transform 0.4s ease",e.style.transformOrigin="top center",e.style.transform="scale(0.5)",t.style.transition="opacity 0.4s ease, transform 0.4s ease",t.style.opacity="0",t.style.transform="translateY(2vh)",setTimeout(()=>{m("screen-profile-edit"),ve()},400)}const _=document.getElementById("age-toggle-icon"),O=document.getElementById("edit-age-input"),N=document.querySelector(".age-label");_.classList.add("active"),_.style.backgroundImage="url('/img/eye_open.svg')",_.addEventListener("click",()=>{_.classList.toggle("active")?(_.style.backgroundImage="url('/img/eye_open.svg')",O.disabled=!1,O.style.filter="none",N&&(N.style.color=""),n.hideAge=!1):(_.style.backgroundImage="url('/img/eye_close.svg')",O.disabled=!0,O.style.filter="grayscale(100%)",N&&(N.style.color="#999"),n.hideAge=!0)});function U(){const e=document.getElementById("profileCard"),t=document.querySelector("#screen-profile .user-info"),o=document.getElementById("screen-profile-edit");if(!e||!t||!o){console.error("–ù–µ –Ω–∞–π–¥–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è."),m("screen-profile");return}e.style.transition="transform 0.4s ease",e.style.transformOrigin="top center",e.style.transform="scale(1)",t.style.transition="opacity 0.4s ease, transform 0.4s ease",t.style.opacity="1",t.style.transform="translateY(0)",setTimeout(()=>{m("screen-profile"),o.style.display="none";const s=document.querySelector("#screen-profile .gradient-card");s&&(s.style.transition="opacity 0.3s ease",s.style.opacity="0",setTimeout(()=>{s.style.opacity="1"},100)),t&&(t.style.transition="opacity 0.3s ease, transform 0.3s ease",t.style.opacity="0",t.style.transform="translateY(20px)",setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},100))},400)}window.exitProfileEditMode=U,typeof W<"u"&&W.exports&&(W.exports.exitProfileEditMode=U);const he=document.getElementById("screen-profile");he&&he.querySelectorAll(".edit-button").forEach(e=>{e.style.cursor="pointer",e.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'"),me()})});const ye=document.getElementById("edit-cancel-button"),be=document.getElementById("edit-save-button");ye&&ye.addEventListener("click",()=>{console.log("‚ñ∂ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ '–û—Ç–º–µ–Ω–∞'"),U()}),be&&be.addEventListener("click",()=>{const e=document.getElementById("edit-bio-input"),t=document.getElementById("edit-age-input"),o=e.value.trim();let s=null;if(!n.hideAge&&(s=parseInt(t.value,10),isNaN(s)||s<1||s>99)){alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç (–æ—Ç 1 –¥–æ 99)");return}const i={userId:n.userId,bio:o,age:s,photos:n.photos};fetch(`${p}/updateProfile`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then(a=>a.json()).then(a=>{if(!a.success){alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è: "+a.error);return}n.bio=o,n.age=s,U()}).catch(a=>{console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:",a),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è")})});async function Ae(){if(H)return!1;try{const t=await(await fetch(`${p}/users`)).json();if(console.log("üîç checkIfRegistered response:",t),!t.success||!Array.isArray(t.data))return console.warn("‚ùå checkIfRegistered: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞"),!1;const o=t.data.find(s=>String(s.userId)===n.userId);if(console.log("üîç checkIfRegistered: –∏—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",n.userId,"–Ω–∞–π–¥–µ–Ω:",!!o),!o)return!1;n.registered=!0,n.gender=o.gender,n.bio=o.bio,n.age=o.age,n.photos=[],o.photo1&&n.photos.push(o.photo1),o.photo2&&n.photos.push(o.photo2),o.photo3&&n.photos.push(o.photo3),n.photos.length===0&&n.photos.push(o.photoUrl||"/img/logo.svg"),n.photoUrl=n.photos[0],n.username=o.username||n.username,n.likes=JSON.parse(o.likes||"[]"),n.dislikes=JSON.parse(o.dislikes||"[]"),n.badge=o.badge||"",n.needPhoto=Number(o.needPhoto||0);try{const i=await(await fetch(`${p}/goals?userId=${n.userId}`)).json();i.success?n.goals=i.goals||[]:n.goals=[]}catch(s){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–π –≤ checkIfRegistered:",s),n.goals=[]}return console.log("‚úÖ checkIfRegistered: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã"),!0}catch(e){return console.error("‚ùå checkIfRegistered:",e),!1}}y();async function J(){if(!H)try{const t=await(await fetch(`${p}/getUser?userId=${n.userId}`)).json();if(!t.success)return;const o=t.data;n.name=o.name||n.name,n.username=o.username||n.username,n.gender=o.gender,n.bio=o.bio||n.bio,n.age=o.age||n.age,n.photos=[],o.photo1&&n.photos.push(o.photo1),o.photo2&&n.photos.push(o.photo2),o.photo3&&n.photos.push(o.photo3),n.photos.length===0&&n.photos.push(o.photoUrl||"/img/logo.svg"),n.photoUrl=n.photos[0],n.likes=JSON.parse(o.likes||"[]"),n.dislikes=JSON.parse(o.dislikes||"[]"),n.badge=o.badge||"",n.needPhoto=Number(o.needPhoto||0),n.is_pro=Number(o.is_pro)===1,n.pro_end=o.pro_end;try{const i=await(await fetch(`${p}/goals?userId=${n.userId}`)).json();i.success?n.goals=i.goals||[]:n.goals=[]}catch(s){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ü–µ–ª–µ–π:",s),n.goals=[]}window.initProFeatures&&window.initProFeatures(n)}catch(e){console.error("‚ùå loadUserData:",e)}}(async function(){console.log("‚ñ∂ initFlow()..."),console.log("üîç currentUser.userId:",n.userId);const t=await Ae();if(console.log("üîç checkIfRegistered —Ä–µ–∑—É–ª—å—Ç–∞—Ç:",t),!t){console.log("‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º welcome"),m("screen-welcome");return}console.log("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ"),await J(),n.gender?(console.log("üîç –ü–æ–ª –∑–∞–¥–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å–≤–∞–π–ø–æ–≤"),m("screen-swipe"),y()):(console.log("üîç –ü–æ–ª –Ω–µ –∑–∞–¥–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞"),m("screen-gender"))})(),y(),setInterval(async()=>{if(n.needPhoto===1)try{await fetch(`${p}/specialPush`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.userId,message:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ, –¥–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —É–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.",keyboard:z()})})}catch(e){console.error("–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–ø—É—à–∞ needPhoto:",e)}},5*60*1e3),R=m});function Y(c){const f=c.querySelector(".badge-like"),h=c.querySelector(".badge-nope");f&&(f.style.opacity=0),h&&(h.style.opacity=0)}function Fe(c){const f=document.createElement("div");f.className="photo-error-modal",f.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    `;const h=document.createElement("div");h.style.cssText=`
      background: white;
      border-radius: 16px;
      padding: 24px;
      margin: 20px;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    `;const r=document.createElement("h3");r.textContent="–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ç–æ",r.style.cssText=`
      margin: 0 0 16px 0;
      color: #333;
      font-size: 18px;
    `;const d=document.createElement("p");d.textContent=c,d.style.cssText=`
      margin: 0 0 24px 0;
      color: #666;
      line-height: 1.5;
    `;const k=document.createElement("button");k.textContent="–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ",k.style.cssText=`
      background: #007AFF;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 12px;
    `,k.onclick=()=>{document.body.removeChild(f),showTelegramModal()};const v=document.createElement("button");v.textContent="–û—Ç–º–µ–Ω–∞",v.style.cssText=`
      background: #F2F2F7;
      color: #007AFF;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
    `,v.onclick=()=>{document.body.removeChild(f)},h.appendChild(r),h.appendChild(d),h.appendChild(k),h.appendChild(v),f.appendChild(h),document.body.appendChild(f)}});export default We();
