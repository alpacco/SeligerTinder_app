[phases.setup]
nixPkgs = [
  "nodejs_22",
  "npm-9_x",
  "python3",
  "python3Packages.pip",
  "pkg-config",
  "opencv4",
  "gcc",
  "cmake"
]

[variables]
PYTHON = "python3"
npm_config_python = "python3"

[phases.install]
cmds = [
  "export PATH=/nix/store/*/bin:$PATH",
  "export PYTHON=$(which python3) && export npm_config_python=$(which python3)",
  "export NODE_PATH=$(which node | xargs dirname)",
  "echo 'üîç Node.js version:' && node --version",
  "echo 'üîç npm version:' && npm --version",
  "echo 'üîç Python path: $PYTHON'",
  "npm i",
  "echo 'üîç === OpenCV Diagnostics After npm install ==='",
  "npm run opencv:diagnose || echo '‚ö†Ô∏è OpenCV diagnostics failed'",
  "echo 'üîç === Attempting OpenCV Rebuild ==='",
  "npm run opencv:rebuild || echo '‚ö†Ô∏è OpenCV rebuild failed - face detection will be disabled'"
]

[phases.build]
cmds = ["echo 'Build phase completed'"]

[start]
cmd = "node start-all.js"
