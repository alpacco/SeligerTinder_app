<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=375, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>SeligerTinder</title>
  <style>
    /* –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ */
    #app {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    #app.loaded {
      opacity: 1;
    }
    /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä */
    .preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f4f4f4;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s ease-in-out;
    }
    .preloader.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .preloader-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #ddd;
      border-top: 3px solid #ee4447;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/pro.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
  <div class="preloader" id="preloader">
    <div class="preloader-spinner"></div>
  </div>
  
  <div id="app">
    <input type="file" id="photo-upload-input" style="display: none;" accept="image/*" />
    <!-- Screen 1: Welcome -->
    <div class="screen" id="screen-welcome">
      <div class="welcome-container">
        <div class="welcome-content">
          <div class="logo-container">
            <img class="logo-avatar"
                 src="<%= (user.photoUrl || "/img/logo.svg") %>"
                 alt="User Avatar" />
          </div>
          <h3 class="welcome-title">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å,<span class="user-name"><%= user.name || '–ì–æ—Å—Ç—å' %></span>, –≤ SeligerTinder
          </h3>
          <p class="welcome-subtext">
            –ò—â–∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å—Ä–µ–¥–∏ —Å–æ—Å–µ–¥–µ–π –≤ –ñ–ö –°–µ–ª–∏–≥–µ—Ä –°–∏—Ç–∏ –∏ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç—è—Ö!
          </p>
        </div>
        <button class="btn-main" id="join-button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
    </div>

    <!-- Screen 2: Gender Selection -->
    <div class="screen" id="screen-gender">
      <div class="gender-content">
        <div class="user-info-header">
          <img class="user-avatar-small"
               src="<%= (user.photoUrl || "/img/avatar.svg") %>"
               alt="User Avatar" />
          <div class="user-id">
            <h3><%= user.name || '–ì–æ—Å—Ç—å' %></h3>
          </div>
        </div>
        <div class="center-container">
          <h3 class="gender-title">–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø–æ–ª</h3>
          <div class="toggle-buttons">
            <button class="btn toggle-btn" id="maleBtn"><h3>–ú–£–ñ–ß–ò–ù–ê</h3></button>
            <button class="btn toggle-btn" id="femaleBtn"><h3>–ñ–ï–ù–©–ò–ù–ê</h3></button>
          </div>
        </div>
      </div>
      <button class="btn-main" id="continue-button">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
    </div>

<!-- Screen 3: Swipe Cards -->
<div class="screen" id="screen-swipe">
  <header class="cards-header">
    <div class="ava-frame" id="avatar_button">
      <img class="avatar_small_2"
           src="<%= (user.photos && user.photos.length) ? user.photos[0] : user.photoUrl %>"
           alt="Avatar" />
      <div class="user-id2">
        <div class="name-age-container">
          <span class="user-name"><%= user.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' %></span>
          <span class="user-age"><%= user.age ? user.age + ' –ª–µ—Ç' : '' %></span>
        </div>
      </div>
    </div>
    <button class="btn-matches" id="matches-button">
      <div class="matches">
        <h3>MATCHES</h3>
        <span class="badge" id="matches-count" style="display:none">0</span>
      </div>
    </button>
  </header>
      <div class="card-container">
        <div class="photo-frame">
          <div class="app-card" id="singleCard">
            <div class="card-badge badge-like">üòç</div>
            <div class="card-badge badge-nope">üö´</div>
            <div class="card-badge badge-match">‚ù§Ô∏è‚Äçüî•</div>
            <div class="gradient-card"></div>
            <div class="user-info">
              <div class="badge-wrapper" style="display:none">
                <img src="" alt="Badge" class="badge-image" />
              </div>
            <div class="name-age-container">
              <span class="user-name" id="swipe-user-name">–ò–º—è</span>
              <span class="user-age" id="swipe-user-age">20 –ª–µ—Ç</span>
            </div>
            <div class="candidate-goals"></div>
            <p class="user-bio" id="swipe-user-bio">–û–ø–∏—Å–∞–Ω–∏–µ</p>
            <div class="paginator"></div>
            </div>
          </div>
        </div>
      </div>
      <footer class="cards-footer">
        <div class="cards-btns">
          <div class="dislike_d"><img class="dislike" src="/img/dislike.svg" alt="Dislike" /></div>
          <div class="chat_s3" style="display:none;"><img class="chat_d" src="/img/chat.svg" alt="Chat" /></div>
          <div class="like_d">
            <svg class="like-icon" width="36" height="36" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
              <path class="st0" d="M40.2,19.3c-5.1-0.5-7.5,2.5-8.2,3.5c-0.6-1-3.1-4-8.2-3.5c-5.4,0.6-10.8,7-5.7,15.6
                c4.2,6.9,13.6,11.9,13.9,12.1l0,0l0,0l0,0l0,0c0.2-0.1,9.7-5.1,13.9-12.1C51,26.3,45.6,19.9,40.2,19.3L40.2,19.3z"/>
            </svg>
          </div>
        </div>
      </footer>
    </div>

    <!-- Screen 4: Matches List -->
    <div class="screen" id="screen-matches">
      <div class="matches-container">
        <header class="app-header matches-header">
          <div class="header-main-row">
          <button class="back-btn" id="back-button">
            <img src="/img/back.svg" alt="Back" />
          </button>
          <h2>–í–∞—à–∏ Matches</h2>
            <span class="header-pro-info"></span>
          </div>
          <div class="header-sub-row"></div>
        </header>
        <div class="matches-divider"></div>
        <div class="matches-list" id="matches-list"></div>
      </div>
    </div>

<!-- Screen 5: Profile View -->
<div class="screen" id="screen-profile">
  <div class="profile-container">
    <header class="app-header profile-header">
      <div class="header-main-row">
      <button class="back-btn" id="profile-back-button">
        <img src="/img/back.svg" alt="Back" />
      </button>
      <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <span class="header-pro-info"></span>
      </div>
      <div class="header-sub-row"></div>
    </header>
    <div class="profile-body">
      <div class="card-container">
        <div class="photo-frame">
          <div class="app-card" id="profileCard">
            <div class="gradient-card"></div>
            <div class="user-info">
              <% if (user.badge) { %>
                <div class="badge-wrapper">
                  <img src="https://sta-black-alpacco.amvera.io<%= user.badge %>"
                       alt="Badge" class="badge-image" />
                </div>
              <% } %>
              <div class="name-age-container">
                <span class="user-name"><%= user.name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' %></span>
                <span class="user-age"><%= user.age ? user.age + ' –ª–µ—Ç' : '' %></span>
              </div>
              <div class="candidate-goals"></div>
              <p class="user-bio"><%= user.bio || '' %></p>
              <div class="paginator"></div>
            </div>
          </div>
        </div>
      </div>
      <button class="edit-button" id="edit-profile-button">–ù–ê–°–¢–†–û–ò–¢–¨</button>
    </div>
  </div>
</div>
    <!-- Screen 6: Profile Edit -->
    <div class="screen" id="screen-profile-edit">
      <div class="profile-edit-container">
        <header class="app-header profile-edit-header">
          <div class="header-main-row">
          <button class="back-btn" id="profile-edit-back-button">
            <img src="/img/back.svg" alt="Back" />
          </button>
          <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
          </div>
          <div class="header-sub-row"></div>
        </header>
        <div class="profile-edit-content">
          <div class="edit-photo-carousel" id="edit-photo-carousel"></div>

          <textarea id="edit-bio-input"
                    placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ (–¥–æ 2 —Å—Ç—Ä–æ–∫)"><%= user.bio || '' %></textarea>
          <div class="edit-age-container">
            <span class="age-label">–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç:</span>
            <div class="age-picker-container">
              <input type="number"
                     id="edit-age-input"
                     min="1" max="99"
                     value="<%= user.age || '' %>" />
              <div class="age-toggle-icon" id="age-toggle-icon"></div>
            </div>
          </div>
        </div>
        <div class="edit-buttons-container">
          <button class="edit-cancel-button" id="cancel-edit-button">–û–¢–ú–ï–ù–ê</button>
          <button class="edit-save-button" id="save-edit-button">–ì–û–¢–û–í–û</button>
        </div>
      </div>
    </div>
  </div>

<!-- Gift Modal -->
<div class="gift-backdrop"></div>
<div id="gift-modal" class="gift-modal">
<div class="gift-modal-content">
    <!-- –°—é–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω–∏–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ -->
    <div class="gift-modal-fixed-top">
      <div class="gift-modal-header">
        <h2 class="gift-modal-title">–ü–æ–¥–∞—Ä–∫–∏</h2>
        <button id="gift-modal-close" class="gift-modal-close-btn">
          <img src="/img/dislike.svg" alt="–ó–∞–∫—Ä—ã—Ç—å" width="36" height="36" />
        </button>
      </div>
      <p class="gift-modal-description">
        –î–∞—Ä–∏—Ç–µ —ç–º–æ—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏! –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫, –∏ –º—ã –ø–µ—Ä–µ–¥–∞–¥–∏–º –µ–≥–æ –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏
      </p>
    </div>

  <!-- –°–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º–æ–µ —Ç–µ–ª–æ -->
  <div class="gift-modal-body">
    <div class="gift-cards-container">
      <% if (Array.isArray(gifts) && gifts.length) { %>
        <% gifts.forEach(function(gift) { %>
          <div class="gift-card" data-gift-id="<%= gift.id %>">
            <img src="<%= gift.PhotoGift %>" alt="<%= gift.AboutGift %>" class="gift-card-img"/>
            <p class="gift-desc"><%= gift.AboutGift %></p>
            <% if (gift.SaleGift && gift.SaleGift > 0) { %>
              <p class="gift-sale">–°–∫–∏–¥–∫–∞ <%= gift.SaleGift %>%</p>
            <% } %>
            <div class="gift-card-body">
              <span class="gift-price"><%= gift.PriceGift %> &#8381;</span>
              <button class="gift-order-btn" onclick="handleGiftOrder(this)">–ó–∞–∫–∞–∑–∞—Ç—å</button>
            </div>
          </div>
        <% }); %>
      <% } else { %>
        <p>–ü–æ–¥–∞—Ä–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
      <% } %>
    </div>
  </div>

  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑—É -->
  <div class="gift-modal-fixed-bottom">
    <button id="gift-detail-btn" class="gift-detail-button">–£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ</button>
  </div>
  </div>
</div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (pop-up) –¥–ª—è PUSH -->
    <div class="tg-modal" id="tg-modal" style="display: none;">
      <div class="tg-modal-content">
        <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∏ –¥–∞–Ω–Ω—ã—Ö</h3>
        <p>
          –í –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ, —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–µ–±–µ –∏ —É–∫–∞–∑–∞—Ç—å –≤–æ–∑—Ä–∞—Å—Ç —á–µ—Ä–µ–∑ –±–æ—Ç–∞. –ù–∞–∂–º–∏—Ç–µ ¬´–û–¢–ü–†–ê–í–ò–¢–¨ –ü–£–®¬ª, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é —Å –æ–ø—Ü–∏—è–º–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
        </p>
        <div class="tg-modal-buttons">
          <button id="tg-modal-ok" class="tg-modal-ok">–û–¢–ü–†–ê–í–ò–¢–¨ –ü–£–®</button>
          <button id="tg-modal-cancel" class="tg-modal-cancel">–ó–ê–ö–†–´–¢–¨</button>
        </div>
      </div>
    </div>

    <script type="module" src="/js/<%= hashMap['main'] %>"></script>
    <script type="module" src="/js/<%= hashMap['profile'] %>"></script>
    <script type="module" src="/js/<%= hashMap['swipe'] %>"></script>
    <script type="module" src="/js/<%= hashMap['card'] %>"></script>
    <script type="module" src="/js/<%= hashMap['api'] %>"></script>
    <script type="module" src="/js/<%= hashMap['utils'] %>"></script>
    <script type="module" src="/js/<%= hashMap['gift'] %>"></script>
    <script type="module" src="/js/<%= hashMap['match'] %>"></script>
    <script type="module" src="/js/<%= hashMap['pro'] %>"></script>
    
    <script>
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
      window.addEventListener('load', function() {
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
        setTimeout(function() {
          const app = document.getElementById('app');
          const preloader = document.getElementById('preloader');
          
          if (app) {
            app.classList.add('loaded');
          }
          
          if (preloader) {
            preloader.classList.add('hidden');
            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(function() {
              preloader.remove();
            }, 300);
          }
        }, 100);
      });
      
      // Fallback: –µ—Å–ª–∏ load –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(function() {
        const app = document.getElementById('app');
        const preloader = document.getElementById('preloader');
        
        if (app && !app.classList.contains('loaded')) {
          app.classList.add('loaded');
        }
        
        if (preloader && !preloader.classList.contains('hidden')) {
          preloader.classList.add('hidden');
          setTimeout(function() {
            preloader.remove();
          }, 300);
        }
      }, 2000);
    </script>
  </body>
</html>