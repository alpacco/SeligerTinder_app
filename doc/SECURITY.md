# üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã –∑–∞—â–∏—Ç—ã

### 1. SQL Injection Protection ‚úÖ
- –í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `?` –∏ `$1, $2, $3` –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ù–∏–∫–∞–∫–∏—Ö f-strings —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ SQL

### 2. Path Traversal Protection ‚úÖ
- –í–∞–ª–∏–¥–∞—Ü–∏—è `userId` (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
- –§—É–Ω–∫—Ü–∏—è `sanitize_path()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ –ø—É—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `..`, `/`, `\` –≤ –ø—É—Ç—è—Ö

### 3. File Upload Security ‚úÖ
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 10 MB)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME —Ç–∏–ø–∞
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ PIL
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ (JPEG, PNG, WEBP)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–∞–∫—Å–∏–º—É–º 10000x10000)
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤

### 4. Security Headers ‚úÖ
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Referrer-Policy: strict-origin-when-cross-origin`
- `Strict-Transport-Security` (–¥–ª—è HTTPS)
- `Content-Security-Policy` (CSP)

### 5. CORS Protection ‚úÖ
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins
- –¢–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã
- –¢–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –ö–µ—à preflight –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 1 —á–∞—Å

### 6. Rate Limiting ‚úÖ
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã: 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å, 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ IP –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### 7. Admin Authorization ‚úÖ
- Bearer token –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è admin endpoints
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `ADMIN_TOKEN`
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints:
  - `/api/get-all-users-for-admin`
  - `/api/get-user-data-for-badge`
  - `/api/search-users-for-admin`
  - `/api/update-user-for-admin`
  - `/api/delete-user-for-admin`
  - `/api/send-message-for-admin`
  - `/api/update-badge`

### 8. Input Validation ‚úÖ
- –í–∞–ª–∏–¥–∞—Ü–∏—è `userId` (—Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)
- –í–∞–ª–∏–¥–∞—Ü–∏—è `photoIndex` (—Ç–æ–ª—å–∫–æ 1, 2, 3)
- –í–∞–ª–∏–¥–∞—Ü–∏—è URL (—Ç–æ–ª—å–∫–æ http/https, –∑–∞—â–∏—Ç–∞ –æ—Ç SSRF)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Whitelist –¥–ª—è –æ–±–Ω–æ–≤–ª—è–µ–º—ã—Ö –ø–æ–ª–µ–π –≤ admin endpoints

### 9. SSRF Protection ‚úÖ
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∞–¥—Ä–µ—Å–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ URL
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ localhost, 127.0.0.1, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–µ—Ç–µ–π
- –¢–∞–π–º–∞—É—Ç –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

### 10. Safe Logging ‚úÖ
- –£–¥–∞–ª–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ª–æ–≥–æ–≤
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã: password, token, secret, key, authorization
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –ø–æ–ª–Ω—ã—Ö stack traces –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### 11. Error Handling ‚úÖ
- –û–±—â–∏–µ –æ—à–∏–±–∫–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- –í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
DATABASE_URL=postgresql://...
BOT_TOKEN=...
WEB_APP_URL=https://...

# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ
ADMIN_TELEGRAM_IDS=123456789,987654321  # Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
# –ò–õ–ò (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏):
ADMIN_TOKEN=your-secret-admin-token  # Bearer token –¥–ª—è –∑–∞—â–∏—Ç—ã admin endpoints

LOCAL=false  # true —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Admin –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± (Telegram ID):**
1. –£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π Telegram ID (–º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @userinfobot)
2. –í Railway –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```
   ADMIN_TELEGRAM_IDS=123456789,987654321
   ```
   (–º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)

3. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ admin endpoints –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ Telegram ID:
   - –í –∑–∞–≥–æ–ª–æ–≤–∫–µ: `X-Telegram-User-Id: 123456789`
   - –ò–ª–∏ –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä–µ: `?telegramUserId=123456789`

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (Bearer Token):**
1. –í Railway –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```
   ADMIN_TOKEN=your-very-secret-token-here
   ```

2. –ü—Ä–∏ –≤—ã–∑–æ–≤–µ admin endpoints –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ç–æ–∫–µ–Ω:
   ```
   Authorization: Bearer your-very-secret-token-here
   ```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ADMIN_TOKEN
```bash
# –í Railway –¥–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
ADMIN_TOKEN=your-very-secret-token-here
```

### 2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- HSTS –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–µ–Ω –¥–ª—è HTTPS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### 3. –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
pip list --outdated
pip install --upgrade <package>
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ rate limits

### 5. Backup
- –†–µ–≥—É–ª—è—Ä–Ω–æ –¥–µ–ª–∞–π—Ç–µ backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –•—Ä–∞–Ω–∏—Ç–µ backup –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SQL Injection
```bash
# –ü–æ–ø—ã—Ç–∫–∞ SQL –∏–Ω—ä–µ–∫—Ü–∏–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞)
curl "https://your-app.com/api/user?userId=1' OR '1'='1"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Path Traversal
```bash
# –ü–æ–ø—ã—Ç–∫–∞ path traversal (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞)
curl -X POST "https://your-app.com/api/photos/upload" \
  -F "userId=../../../etc/passwd" \
  -F "file=@photo.jpg"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ File Upload
```bash
# –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞)
curl -X POST "https://your-app.com/api/photos/upload" \
  -F "userId=123456" \
  -F "file=@malicious.exe"
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Admin Authorization
```bash
# –ë–µ–∑ —Ç–æ–∫–µ–Ω–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 401)
curl "https://your-app.com/api/get-all-users-for-admin"

# –° —Ç–æ–∫–µ–Ω–æ–º (–¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å)
curl "https://your-app.com/api/get-all-users-for-admin" \
  -H "Authorization: Bearer your-admin-token"
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Telegram Bot Token**: –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–æ –Ω–µ —Ä–æ—Ç–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **Rate Limiting**: –ë–∞–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ IP, –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–æ–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
3. **CORS**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç wildcard –¥–ª—è Railway –¥–æ–º–µ–Ω–æ–≤ (`*.up.railway.app`)
4. **Admin Token**: –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –±–µ–∑ JWT –∏–ª–∏ OAuth

## –ü–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ

- [ ] JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] 2FA –¥–ª—è admin –ø–∞–Ω–µ–ª–∏
- [ ] WAF (Web Application Firewall)
- [ ] DDoS –∑–∞—â–∏—Ç–∞
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- [ ] Audit logging –¥–ª—è admin –¥–µ–π—Å—Ç–≤–∏–π
- [ ] IP whitelist –¥–ª—è admin endpoints

