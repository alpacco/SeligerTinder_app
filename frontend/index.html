<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=375, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>SeligerTinder</title>
  <style>
    /* –°–∫—Ä—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ */
    #app {
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
    }
    #app.loaded {
      opacity: 1;
    }
    /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä */
    .preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f4f4f4;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s ease-in-out;
    }
    .preloader.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .preloader-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #ddd;
      border-top: 3px solid #ee4447;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <link rel="stylesheet" href="/css/main.css?v=2025-01-19-remove-gift-btn-v1" id="main-css-link" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    // –ö–†–ò–¢–ò–ß–ù–û: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Å–±—Ä–æ—Å –∫–Ω–æ–ø–∫–∏ "–ü–æ–º–∞—Ö–∞—Ç—å" –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    (function() {
      let checkCount = 0;
      function resetWaveButton() {
        checkCount++;
        const dislikeBtn = document.querySelector(".dislike_d");
        if (dislikeBtn) {
          const hasWaveBtn = dislikeBtn.classList.contains('wave-btn');
          const hasChatBtn = dislikeBtn.classList.contains('chat-btn');
          const hasWaveSvg = dislikeBtn.innerHTML.includes('wave.svg');
          const hasChatSvg = dislikeBtn.innerHTML.includes('chat.svg');
          const hasWaveText = dislikeBtn.textContent && (dislikeBtn.textContent.includes('üëã') || dislikeBtn.textContent.includes('–ü–æ–º–∞—Ö–∞—Ç—å'));
          const hasWaveImg = dislikeBtn.querySelector('img[src*="wave"]') || dislikeBtn.querySelector('img[alt*="wave" i]');
          const bgColor = window.getComputedStyle(dislikeBtn).backgroundColor;
          const isRedBg = bgColor.includes('255, 94, 94') || bgColor.includes('rgb(255, 94, 94)') || bgColor.includes('#ff5e5e');
          
          // –õ–æ–≥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–µ 100 –ø—Ä–æ–≤–µ—Ä–æ–∫ (5 —Å–µ–∫—É–Ω–¥)
          if (checkCount % 100 === 0) {
            console.log('üîµ [INLINE] –ü—Ä–æ–≤–µ—Ä–∫–∞ #' + checkCount, {
              hasWaveBtn,
              hasChatBtn,
              hasWaveSvg,
              hasChatSvg,
              hasWaveText,
              hasWaveImg: !!hasWaveImg,
              isRedBg,
              className: dislikeBtn.className,
              innerHTML: dislikeBtn.innerHTML.substring(0, 100),
              textContent: dislikeBtn.textContent,
              backgroundColor: bgColor
            });
          }
          
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –õ–Æ–ë–û–ï –∏–∑ —É—Å–ª–æ–≤–∏–π
          if (hasWaveBtn || hasChatBtn || hasWaveSvg || hasChatSvg || hasWaveText || hasWaveImg || (isRedBg && !window.inMutualMatch)) {
            console.error('üö® [INLINE] –ö–†–ò–¢–ò–ß–ù–û: –ö–Ω–æ–ø–∫–∞ "–ü–æ–º–∞—Ö–∞—Ç—å" –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞! –°–±—Ä–∞—Å—ã–≤–∞–µ–º...', {
              checkCount,
              hasWaveBtn,
              hasChatBtn,
              hasWaveSvg,
              hasChatSvg,
              hasWaveText,
              hasWaveImg: !!hasWaveImg,
              isRedBg,
              inMutualMatch: window.inMutualMatch
            });
            dislikeBtn.classList.remove('wave-btn', 'chat-btn');
            dislikeBtn.className = 'dislike_d';
            dislikeBtn.innerHTML = `<svg class="dislike-icon" width="36" height="36" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><rect class="st0" x="29.5" y="14.61" width="5" height="34.78" rx="2.5" ry="2.5" transform="translate(-13.25 32) rotate(-45)"/><rect class="st0" x="14.61" y="29.5" width="34.78" height="5" rx="2.5" ry="2.5" transform="translate(-13.25 32) rotate(-45)"/></svg>`;
            dislikeBtn.style.backgroundColor = '';
            dislikeBtn.style.fontSize = '';
            dislikeBtn.style.color = '';
            dislikeBtn.textContent = '';
            dislikeBtn.onclick = null;
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å wave
            const waveImgs = dislikeBtn.querySelectorAll('img[src*="wave"], img[alt*="wave" i]');
            waveImgs.forEach(img => img.remove());
          }
        }
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', resetWaveButton);
      } else {
        resetWaveButton();
      }
      
      // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 50ms
      setInterval(resetWaveButton, 50);
      console.log('‚úÖ [INLINE] –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Å–±—Ä–æ—Å –∫–Ω–æ–ø–∫–∏ "–ü–æ–º–∞—Ö–∞—Ç—å" —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω');
    })();
    
    // –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞ Telegram
    // –í–ê–ñ–ù–û: –≤–µ—Ä—Å–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –°–¢–ê–¢–ò–ß–ï–°–ö–û–ô, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞!
    const APP_VERSION = '2025-01-19-remove-gift-btn-v1';
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏
    (function forceReloadIfVersionChanged() {
      try {
        const HTML_VERSION_KEY = 'sp_cache_version_html';
        const prev = localStorage.getItem(HTML_VERSION_KEY);
        if (prev !== APP_VERSION) {
          localStorage.setItem(HTML_VERSION_KEY, APP_VERSION);
          const url = window.location.pathname + '?v=' + APP_VERSION;
          console.log('üîÑ [CACHE] –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–ê–Ø –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏:', url);
          console.log('üîÑ [CACHE] –ü—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è:', prev, '-> –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è:', APP_VERSION);
          window.location.replace(url);
          return;
        }
        console.log('‚úÖ [CACHE] –í–µ—Ä—Å–∏—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:', APP_VERSION);
      } catch (e) {
        console.warn('‚ö†Ô∏è [CACHE] Cache cleanup skipped:', e);
      }
    })();
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º window.currentUser –°–†–ê–ó–£ –∏–∑ Telegram, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
    // –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏–º—è –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
    (function() {
      if (window.Telegram && window.Telegram.WebApp) {
        const tg = window.Telegram.WebApp;
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
          const u = tg.initDataUnsafe.user;
          window.currentUser = {
            userId: String(u.id || "UserID"),
            name: u.first_name || "Username",
            username: u.username || "",
            photoUrl: (u.photo_url && u.photo_url.startsWith("http")) ? u.photo_url : "/img/logo.svg",
            registered: false
          };
          console.log('‚úÖ [INLINE] window.currentUser —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ Telegram:', window.currentUser);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ —Å—Ä–∞–∑—É, –µ—Å–ª–∏ DOM –≥–æ—Ç–æ–≤
          function updateWelcomeName() {
            if (document.readyState === 'loading') {
              setTimeout(updateWelcomeName, 100);
              return;
            }
            const welcomeUserName = document.querySelector('#screen-welcome .user-name');
            if (welcomeUserName && window.currentUser && window.currentUser.name && window.currentUser.name !== "Username") {
              welcomeUserName.textContent = window.currentUser.name;
              console.log('‚úÖ [INLINE] –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ:', window.currentUser.name);
            }
          }
          updateWelcomeName();
        }
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é showScreen –°–†–ê–ó–£ (–¥–æ –∑–∞–≥—Ä—É–∑–∫–∏ main.js)
      if (!window.showScreen) {
        window.showScreen = function(screenId) {
          console.log('üîµ [FALLBACK] showScreen –≤—ã–∑–≤–∞–Ω–∞ (–≤—Ä–µ–º–µ–Ω–Ω–∞—è):', screenId);
          const allScreens = document.querySelectorAll('.screen');
          allScreens.forEach(scr => scr.style.display = 'none');
          const target = document.getElementById(screenId);
          if (target) {
            target.style.display = 'block';
            console.log('‚úÖ [FALLBACK] –≠–∫—Ä–∞–Ω –ø–æ–∫–∞–∑–∞–Ω:', screenId);
          }
        };
        console.log('‚úÖ [INLINE] window.showScreen —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤—Ä–µ–º–µ–Ω–Ω—ã–π)');
      }
    })();
  </script>
</head>
<body>
  <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä -->
  <div class="preloader" id="preloader">
    <div class="preloader-spinner"></div>
  </div>
  
  <div id="app">
    <input type="file" id="photo-upload-input" style="display: none;" accept="image/*" />
    <!-- Screen 1: Welcome -->
    <div class="screen active" id="screen-welcome">
      <div class="welcome-container">
        <div class="welcome-content">
          <div class="logo-container">
            <img class="logo-avatar"
                 src="/img/logo.svg"
                 alt="User Avatar" />
          </div>
          <h3 class="welcome-title">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å,<span class="user-name">–ì–æ—Å—Ç—å</span>, –≤ SeligerTinder
          </h3>
          <p class="welcome-subtext">
            –ò—â–∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å—Ä–µ–¥–∏ —Å–æ—Å–µ–¥–µ–π –≤ –ñ–ö –°–µ–ª–∏–≥–µ—Ä –°–∏—Ç–∏ –∏ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç—è—Ö!
          </p>
        </div>
        <button class="btn-main" id="join-button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>
    </div>

    <!-- Screen 2: Gender Selection -->
    <div class="screen" id="screen-gender">
      <div class="gender-content">
        <div class="user-info-header">
          <img class="user-avatar-small"
               src="/img/avatar.svg"
               alt="User Avatar" />
          <div class="user-id">
            <h3>–ì–æ—Å—Ç—å</h3>
          </div>
        </div>
        <div class="center-container">
          <h3 class="gender-title">–í—ã–±–µ—Ä–∏ —Å–≤–æ–π –ø–æ–ª</h3>
          <div class="toggle-buttons">
            <button class="btn toggle-btn" id="maleBtn"><h3>–ú–£–ñ–ß–ò–ù–ê</h3></button>
            <button class="btn toggle-btn" id="femaleBtn"><h3>–ñ–ï–ù–©–ò–ù–ê</h3></button>
          </div>
        </div>
      </div>
      <button class="btn-main" id="continue-button">–ü–†–û–î–û–õ–ñ–ò–¢–¨</button>
    </div>

<!-- Screen 3: Swipe Cards -->
<div class="screen" id="screen-swipe">
  <header class="cards-header">
    <div class="ava-frame" id="avatar_button">
      <img class="avatar_small_2"
           src="/img/avatar.svg"
           alt="Avatar" />
      <div class="user-id2">
        <div class="name-age-container">
          <span class="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
          <span class="user-age"></span>
        </div>
      </div>
    </div>
    <button class="btn-matches" id="matches-button">
      <div class="matches">
        <h3>MATCHES</h3>
        <span class="badge" id="matches-count" style="display:none">0</span>
      </div>
    </button>
  </header>
      <div class="card-container">
        <div class="photo-frame">
          <div class="app-card" id="singleCard">
            <div class="card-badge badge-like">üòç</div>
            <div class="card-badge badge-nope">üö´</div>
            <div class="card-badge badge-match">‚ù§Ô∏è‚Äçüî•</div>
            <div class="gradient-card"></div>
            <div class="user-info">
              <div class="badge-wrapper" style="display:none">
                <img src="" alt="Badge" class="badge-image" />
              </div>
            <div class="name-age-container">
              <span class="user-name" id="swipe-user-name">–ò–º—è</span>
              <span class="user-age" id="swipe-user-age">20 –ª–µ—Ç</span>
            </div>
            <div class="candidate-goals"></div>
            <p class="user-bio" id="swipe-user-bio">–û–ø–∏—Å–∞–Ω–∏–µ</p>
            <div class="paginator"></div>
            </div>
          </div>
        </div>
      </div>
      <footer class="cards-footer">
        <div class="cards-btns">
          <div class="dislike_d"><img class="dislike" src="/img/dislike.svg" alt="Dislike" /></div>
          <div class="chat_s3" style="display:none;"><img class="chat_d" src="/img/chat.svg" alt="Chat" /></div>
          <div class="like_d">
            <svg class="like-icon" width="36" height="36" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
              <path class="st0" d="M40.2,19.3c-5.1-0.5-7.5,2.5-8.2,3.5c-0.6-1-3.1-4-8.2-3.5c-5.4,0.6-10.8,7-5.7,15.6
                c4.2,6.9,13.6,11.9,13.9,12.1l0,0l0,0l0,0l0,0c0.2-0.1,9.7-5.1,13.9-12.1C51,26.3,45.6,19.9,40.2,19.3L40.2,19.3z"/>
            </svg>
          </div>
        </div>
      </footer>
    </div>

    <!-- Screen 4: Matches List -->
    <div class="screen" id="screen-matches">
      <div class="matches-container">
        <header class="app-header matches-header">
          <div class="header-main-row">
          <button class="back-btn" id="back-button">
            <img src="/img/back.svg" alt="Back" />
          </button>
          <h2>–í–∞—à–∏ Matches</h2>
            <span class="header-pro-info"></span>
          </div>
          <div class="header-sub-row"></div>
        </header>
        <div class="matches-divider"></div>
        <div class="matches-list" id="matches-list"></div>
      </div>
    </div>

<!-- Screen 5: Profile View -->
<div class="screen" id="screen-profile">
  <div class="profile-container">
    <header class="app-header profile-header">
      <div class="header-main-row">
      <button class="back-btn" id="profile-back-button">
        <img src="/img/back.svg" alt="Back" />
      </button>
      <h2>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <span class="header-pro-info"></span>
      </div>
      <div class="header-sub-row"></div>
    </header>
    <div class="profile-body">
      <div class="card-container">
        <div class="photo-frame">
          <div class="app-card" id="profileCard">
            <div class="gradient-card"></div>
            <div class="user-info">
              <div class="badge-wrapper" style="display:none">
                <img src="" alt="Badge" class="badge-image" />
              </div>
              <div class="name-age-container">
                <span class="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                <span class="user-age"></span>
              </div>
              <div class="candidate-goals"></div>
              <p class="user-bio"></p>
              <div class="paginator"></div>
            </div>
          </div>
        </div>
      </div>
      <button class="edit-button" id="edit-profile-button">–ù–ê–°–¢–†–û–ò–¢–¨</button>
    </div>
  </div>
</div>
    <!-- Screen 6: Profile Edit -->
    <div class="screen" id="screen-profile-edit">
      <div class="profile-edit-container">
        <header class="app-header profile-edit-header">
          <div class="header-main-row">
          <button class="back-btn" id="profile-edit-back-button">
            <img src="/img/back.svg" alt="Back" />
          </button>
          <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
          </div>
          <div class="header-sub-row"></div>
        </header>
        <div class="profile-edit-content">
          <div class="edit-photo-carousel" id="edit-photo-carousel"></div>

          <textarea id="edit-bio-input"
                    placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ (–¥–æ 2 —Å—Ç—Ä–æ–∫)"></textarea>
          <div class="edit-age-container">
            <span class="age-label">–í–∞—à –≤–æ–∑—Ä–∞—Å—Ç:</span>
            <div class="age-picker-container">
              <input type="number"
                     id="edit-age-input"
                     min="1" max="99"
                     value="" />
              <div class="age-toggle-icon" id="age-toggle-icon"></div>
            </div>
          </div>
        </div>
        <div class="edit-buttons-container">
          <button class="edit-cancel-button" id="cancel-edit-button">–û–¢–ú–ï–ù–ê</button>
          <button class="edit-save-button" id="save-edit-button">–ì–û–¢–û–í–û</button>
        </div>
      </div>
    </div>
  </div>

<!-- Gift Modal -->
<div class="gift-backdrop"></div>
<div id="gift-modal" class="gift-modal">
<div class="gift-modal-content">
    <!-- –°—é–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä—Ö–Ω–∏–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ -->
    <div class="gift-modal-fixed-top">
      <div class="gift-modal-header">
        <h2 class="gift-modal-title">–ü–æ–¥–∞—Ä–∫–∏</h2>
        <button id="gift-modal-close" class="gift-modal-close-btn">
          <img src="/img/dislike.svg" alt="–ó–∞–∫—Ä—ã—Ç—å" width="36" height="36" />
        </button>
      </div>
      <p class="gift-modal-description">
        –î–∞—Ä–∏—Ç–µ —ç–º–æ—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏! –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫, –∏ –º—ã –ø–µ—Ä–µ–¥–∞–¥–∏–º –µ–≥–æ –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏
      </p>
    </div>

  <!-- –°–∫—Ä–æ–ª–ª–∏—Ä—É–µ–º–æ–µ —Ç–µ–ª–æ -->
  <div class="gift-modal-body">
    <div class="gift-cards-container">
      <p>–ü–æ–¥–∞—Ä–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    </div>
  </div>

  <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑—É -->
  <div class="gift-modal-fixed-bottom">
    <button id="gift-detail-btn" class="gift-detail-button">–£–∑–Ω–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ</button>
  </div>
  </div>
</div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (pop-up) –¥–ª—è PUSH -->
    <div class="tg-modal" id="tg-modal" style="display: none;">
      <div class="tg-modal-content">
        <h3>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∏ –¥–∞–Ω–Ω—ã—Ö</h3>
        <p>
          –í –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ, —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–µ–±–µ –∏ —É–∫–∞–∑–∞—Ç—å –≤–æ–∑—Ä–∞—Å—Ç —á–µ—Ä–µ–∑ –±–æ—Ç–∞. –ù–∞–∂–º–∏—Ç–µ ¬´–û–¢–ü–†–ê–í–ò–¢–¨ –ü–£–®¬ª, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é —Å –æ–ø—Ü–∏—è–º–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
        </p>
        <div class="tg-modal-buttons">
          <button id="tg-modal-ok" class="tg-modal-ok">–û–¢–ü–†–ê–í–ò–¢–¨ –ü–£–®</button>
          <button id="tg-modal-cancel" class="tg-modal-cancel">–ó–ê–ö–†–´–¢–¨</button>
        </div>
      </div>
    </div>

    <script>
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å —Å–µ—Ä–≤–µ—Ä–∞
      (async function() {
        console.log('üîµ [INIT] –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
        try {
          const response = await fetch('/api/config');
          console.log('üîµ [INIT] –û—Ç–≤–µ—Ç –æ—Ç /api/config:', response.status, response.statusText);
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const config = await response.json();
          console.log('‚úÖ [INIT] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞:', config);
          
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
          window.API_BASE_URL = config.apiBaseUrl || window.location.origin + '/api';
          window.API_URL = config.apiBaseUrl || window.location.origin + '/api';
          window.WEB_APP_URL = config.webAppUrl || window.location.origin;
          
          console.log('üîß [Config] API_BASE_URL:', window.API_BASE_URL);
          console.log('üîß [Config] API_URL:', window.API_URL);
          console.log('üîß [Config] WEB_APP_URL:', window.WEB_APP_URL);
          console.log('üîß [Config] hashMap:', config.hashMap);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º CSS –µ—Å–ª–∏ –µ—Å—Ç—å hashMap
          if (config.hashMap && config.hashMap['main-css']) {
            const cssLink = document.getElementById('main-css-link');
            if (cssLink) {
              const newHref = '/css/' + config.hashMap['main-css'];
              console.log('üîß [Config] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CSS:', cssLink.href, '->', newHref);
              cssLink.href = newHref;
            }
          }
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º JS —Ñ–∞–π–ª—ã —Å cache busting –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
          const APP_VERSION = '2025-01-19-remove-gift-btn-v1';
          const scripts = ['main', 'profile', 'swipe', 'card', 'api', 'utils', 'gift', 'match', 'pro'];
          console.log('üîµ [INIT] –ó–∞–≥—Ä—É–∑–∫–∞ JS —Ñ–∞–π–ª–æ–≤...');
          console.log('üîÑ [CACHE] –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', APP_VERSION);
          
          // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ —Å fallback
          function loadScriptWithFallback(name, hashMap, version) {
            const filename = hashMap && hashMap[name] ? hashMap[name] : `${name}.js`;
            const scriptUrl = '/js/' + filename + '?v=' + version;
            const fallbackUrl = '/js/' + name + '.js?v=' + version;
            
            console.log(`  üì¶ –ó–∞–≥—Ä—É–∑–∫–∞: ${scriptUrl}`);
            
            const script = document.createElement('script');
            script.type = 'module';
            script.src = scriptUrl;
            
            script.onload = () => {
              console.log(`  ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω: ${scriptUrl}`);
            };
            
            script.onerror = (err) => {
              console.error(`  ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${scriptUrl}:`, err);
              
              // –ï—Å–ª–∏ —Ñ–∞–π–ª —Å hash –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
              let fallbackTried = false;
              
              // –í–∞—Ä–∏–∞–Ω—Ç 1: –ø—Ä–æ–±—É–µ–º –±–µ–∑ hash
              if (hashMap && hashMap[name]) {
                console.log(`  üîÑ –ü—Ä–æ–±—É–µ–º fallback 1: ${fallbackUrl}`);
                const fallbackScript = document.createElement('script');
                fallbackScript.type = 'module';
                fallbackScript.src = fallbackUrl;
                fallbackScript.onload = () => {
                  console.log(`  ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω (fallback 1): ${fallbackUrl}`);
                  fallbackTried = true;
                };
                fallbackScript.onerror = (fallbackErr) => {
                  console.error(`  ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ fallback 1 ${fallbackUrl}:`, fallbackErr);
                  
                  // –í–∞—Ä–∏–∞–Ω—Ç 2: –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ª—é–±–æ–π —Ñ–∞–π–ª —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —á–µ—Ä–µ–∑ API
                  console.log(`  üîÑ –ü—Ä–æ–±—É–µ–º fallback 2: –∑–∞–ø—Ä–æ—Å –∫ /api/config –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è hash-map`);
                  fetch('/api/config')
                    .then(res => res.json())
                    .then(config => {
                      if (config.hashMap && config.hashMap[name]) {
                        const newFilename = config.hashMap[name];
                        const newScriptUrl = '/js/' + newFilename + '?v=' + version;
                        console.log(`  üîÑ –ü—Ä–æ–±—É–µ–º fallback 3: ${newScriptUrl}`);
                        const newFallbackScript = document.createElement('script');
                        newFallbackScript.type = 'module';
                        newFallbackScript.src = newScriptUrl;
                        newFallbackScript.onload = () => console.log(`  ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω (fallback 3): ${newScriptUrl}`);
                        newFallbackScript.onerror = (newErr) => {
                          console.error(`  ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ fallback 3 ${newScriptUrl}:`, newErr);
                          console.error(`  ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —Ñ–∞–π–ª ${name}.js –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∏ –≤ –æ–¥–Ω–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ!`);
                          if (name === 'main') {
                            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                          }
                        };
                        document.body.appendChild(newFallbackScript);
                      } else {
                        console.error(`  ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —Ñ–∞–π–ª ${name}.js –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–º hash-map!`);
                      }
                    })
                    .catch(apiErr => {
                      console.error(`  ‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ /api/config:`, apiErr);
                      console.error(`  ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —Ñ–∞–π–ª ${name}.js –Ω–µ –Ω–∞–π–¥–µ–Ω!`);
                    });
                };
                document.body.appendChild(fallbackScript);
                fallbackTried = true;
              }
              
              if (!fallbackTried) {
                console.error(`  ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —Ñ–∞–π–ª ${name}.js –Ω–µ –Ω–∞–π–¥–µ–Ω!`);
              }
            };
            
            document.body.appendChild(script);
          }
          
          scripts.forEach(name => {
            loadScriptWithFallback(name, config.hashMap, APP_VERSION);
          });
          console.log('‚úÖ [INIT] –í—Å–µ JS —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ DOM');
        } catch (error) {
          console.error('‚ùå [INIT] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', error);
          // Fallback –∑–Ω–∞—á–µ–Ω–∏—è
          window.API_BASE_URL = window.location.origin + '/api';
          window.API_URL = window.location.origin + '/api';
          window.WEB_APP_URL = window.location.origin;
          
          console.log('‚ö†Ô∏è [INIT] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è fallback –∑–Ω–∞—á–µ–Ω–∏—è:');
          console.log('  API_BASE_URL:', window.API_BASE_URL);
          console.log('  WEB_APP_URL:', window.WEB_APP_URL);
          
          // –ó–∞–≥—Ä—É–∂–∞–µ–º JS —Ñ–∞–π–ª—ã –±–µ–∑ hash (fallback —Å –≤–µ—Ä—Å–∏–µ–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫)
          const APP_VERSION_FALLBACK = '2025-01-19-wave-btn-fix-v2';
          const scripts = ['main', 'profile', 'swipe', 'card', 'api', 'utils', 'gift', 'match', 'pro'];
          scripts.forEach(name => {
            const script = document.createElement('script');
            script.type = 'module';
            script.src = '/js/' + name + '.js?v=' + APP_VERSION_FALLBACK;
            script.onload = () => console.log(`  ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω (fallback): /js/${name}.js`);
            script.onerror = (err) => {
              console.error(`  ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ (fallback) /js/${name}.js:`, err);
              console.error(`  ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: —Ñ–∞–π–ª ${name}.js –Ω–µ –Ω–∞–π–¥–µ–Ω!`);
              // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—à–∏–±–∫—É —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
              if (name === 'main') {
                console.error('  üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: main.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å!');
              }
            };
            document.body.appendChild(script);
          });
        }
      })();
      
      // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏, –ë–ï–ó –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞)
      function checkJoinButton() {
        console.log('üîµ [DOM] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏ join-button...');
        const joinButton = document.getElementById('join-button');
        if (joinButton) {
          console.log('‚úÖ [DOM] –ö–Ω–æ–ø–∫–∞ join-button –Ω–∞–π–¥–µ–Ω–∞:', joinButton);
          console.log('  - ID:', joinButton.id);
          console.log('  - –ö–ª–∞—Å—Å:', joinButton.className);
          console.log('  - –¢–µ–∫—Å—Ç:', joinButton.textContent);
          console.log('  - API_URL:', window.API_URL);
          console.log('  - API_BASE_URL:', window.API_BASE_URL);
          console.log('  - window.showScreen:', typeof window.showScreen);
          console.log('  - window.currentUser:', window.currentUser);
          console.log('  - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π: –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ DevTools');
          // –ù–ï –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–¥–µ—Å—å - –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –≤ main.js
        }
      }
      
      // –£–î–ê–õ–ï–ù: –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –º–µ—à–∞–ª —Ä–∞–±–æ—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏–∑ main.js
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ join-button —Ç–µ–ø–µ—Ä—å –¢–û–õ–¨–ö–û –≤ main.js
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É –∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkJoinButton);
      } else {
        checkJoinButton();
      }
      
      // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
      window.addEventListener('load', () => {
        console.log('üîµ [DOM] window.load –ø—Ä–æ–∏–∑–æ—à–µ–ª');
        console.log('  - window.showScreen:', typeof window.showScreen);
        console.log('  - window.currentUser:', window.currentUser);
        console.log('  - window.API_URL:', window.API_URL);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
          console.log('üîµ [DOM] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏...');
          
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–ª–∞
          if (typeof window.setupGenderScreenHandlers === 'function') {
            window.setupGenderScreenHandlers();
          }
          
          checkJoinButton();
        }, 500);
        
        setTimeout(() => {
          console.log('üîµ [DOM] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 1000ms –ø–æ—Å–ª–µ load');
          checkJoinButton();
        }, 1000);
        
        setTimeout(() => {
          console.log('üîµ [DOM] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 2000ms –ø–æ—Å–ª–µ load');
          checkJoinButton();
        }, 2000);
        
        setTimeout(() => {
          console.log('üîµ [DOM] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3000ms –ø–æ—Å–ª–µ load');
          checkJoinButton();
        }, 3000);
      });
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
      window.addEventListener('load', function() {
        setTimeout(function() {
          const app = document.getElementById('app');
          const preloader = document.getElementById('preloader');
          
          if (app) {
            app.classList.add('loaded');
          }
          
          if (preloader) {
            preloader.classList.add('hidden');
            setTimeout(function() {
              preloader.remove();
            }, 300);
          }
        }, 100);
      });
      
      // Fallback: –µ—Å–ª–∏ load –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(function() {
        const app = document.getElementById('app');
        const preloader = document.getElementById('preloader');
        
        if (app && !app.classList.contains('loaded')) {
          app.classList.add('loaded');
        }
        
        if (preloader && !preloader.classList.contains('hidden')) {
          preloader.classList.add('hidden');
          setTimeout(function() {
            preloader.remove();
          }, 300);
        }
      }, 2000);
    </script>
  </body>
</html>

